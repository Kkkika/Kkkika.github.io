<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>å¿«é€Ÿç²¾é€šSQL | Kkkika</title><meta name="author" content="Kika"><meta name="copyright" content="Kika"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="é‡ç‚¹çŸ¥è¯†ï¼›SQLåŸºç¡€ï¼›åˆ·7å¤§ç±»å‹SQLé¢˜ï¼›ç±»å‹è½¬æ¢ï¼›">
<meta property="og:type" content="article">
<meta property="og:title" content="å¿«é€Ÿç²¾é€šSQL">
<meta property="og:url" content="https://kkkika.github.io/2025/10/20/%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/index.html">
<meta property="og:site_name" content="Kkkika">
<meta property="og:description" content="é‡ç‚¹çŸ¥è¯†ï¼›SQLåŸºç¡€ï¼›åˆ·7å¤§ç±»å‹SQLé¢˜ï¼›ç±»å‹è½¬æ¢ï¼›">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kkkika.github.io/Cover/SQL.png">
<meta property="article:published_time" content="2025-10-20T09:17:43.000Z">
<meta property="article:modified_time" content="2025-10-29T02:40:00.692Z">
<meta property="article:author" content="Kika">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="PostgreSQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kkkika.github.io/Cover/SQL.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "å¿«é€Ÿç²¾é€šSQL",
  "url": "https://kkkika.github.io/2025/10/20/%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/",
  "image": "https://kkkika.github.io/Cover/SQL.png",
  "datePublished": "2025-10-20T09:17:43.000Z",
  "dateModified": "2025-10-29T02:40:00.692Z",
  "author": [
    {
      "@type": "Person",
      "name": "Kika",
      "url": "https://kkkika.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://kkkika.github.io/2025/10/20/%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":-1,"unescape":true,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":2,"languages":{"author":"ä½œè€…: Kika","link":"é“¾æ¥: ","source":"æ¥æº: Kkkika","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#fcc10f","bgDark":"#1f1f1f","position":"bottom-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'å¿«é€Ÿç²¾é€šSQL',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-file-pen"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æŠ€æœ¯æ ‡ç­¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-sun fa-spin"></i><span> ç”Ÿæ´»</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/delicious/"><i class="fa-fw fa fa-laugh-squint"></i><span> ç¾é£Ÿ</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-image"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-headphones"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa fa-video"></i><span> å½±è§†</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> å¿«é€Ÿé“¾æ¥</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(./../Cover/SQL.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Kkkika</span></a><a class="nav-page-title" href="/"><span class="site-name">å¿«é€Ÿç²¾é€šSQL</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-file-pen"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æŠ€æœ¯æ ‡ç­¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-sun fa-spin"></i><span> ç”Ÿæ´»</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/delicious/"><i class="fa-fw fa fa-laugh-squint"></i><span> ç¾é£Ÿ</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-image"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-headphones"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa fa-video"></i><span> å½±è§†</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> å¿«é€Ÿé“¾æ¥</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">å¿«é€Ÿç²¾é€šSQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-10-20T09:17:43.000Z" title="å‘è¡¨äº 2025-10-20 17:17:43">2025-10-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-10-29T02:40:00.692Z" title="æ›´æ–°äº 2025-10-29 10:40:00">2025-10-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%93%E7%B2%BE%E8%AE%AD%E7%BB%83/">ä¸“ç²¾è®­ç»ƒ</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>32åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-10-29 10:40:00&quot;}" hidden></div><h1 id="é‡ç‚¹çŸ¥è¯†"><a href="#é‡ç‚¹çŸ¥è¯†" class="headerlink" title="é‡ç‚¹çŸ¥è¯†"></a>é‡ç‚¹çŸ¥è¯†</h1><h2 id="SQLæ‰§è¡Œé¡ºåºï¼š"><a href="#SQLæ‰§è¡Œé¡ºåºï¼š" class="headerlink" title="SQLæ‰§è¡Œé¡ºåºï¼š"></a>SQLæ‰§è¡Œé¡ºåºï¼š</h2><p>1.<code>FROM</code> &amp; <code>JOIN</code> â†’ 2. <code>WHERE</code> â†’ 3. <code>GROUP BY</code> â†’ 4. <code>HAVING</code> â†’ 5. <code>SELECT</code> â†’ 6. <code>ORDER BY</code></p>
<ul>
<li><strong>FROM å’Œ JOIN</strong>ï¼šé¦–å…ˆç¡®å®šè¦ä»å“ªäº›è¡¨ä¸­è·å–æ•°æ®</li>
<li><strong>WHERE</strong>ï¼šå¯¹FROMå’ŒJOINè¿”å›çš„è¡Œè¿›è¡Œè¿‡æ»¤</li>
<li><strong>GROUP BY</strong>ï¼šå°†è¿‡æ»¤åçš„è¡Œåˆ†ç»„</li>
<li><strong>HAVING</strong>ï¼šå¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œè¿‡æ»¤</li>
<li><strong>SELECT</strong>ï¼šé€‰æ‹©è¦è¿”å›çš„åˆ—ï¼ˆåŒ…æ‹¬è®¡ç®—å’Œåˆ«åï¼‰</li>
<li><strong>DISTINCT</strong>ï¼šå»é™¤é‡å¤çš„è¡Œ</li>
<li><strong>ORDER BY</strong>ï¼šå¯¹ç»“æœè¿›è¡Œæ’åº</li>
<li><strong>LIMIT&#x2F;OFFSET&#x2F;TOP</strong>ï¼šé™åˆ¶è¿”å›çš„è¡Œæ•°</li>
</ul>
<h1 id="SQLåŸºç¡€"><a href="#SQLåŸºç¡€" class="headerlink" title="SQLåŸºç¡€"></a>SQLåŸºç¡€</h1><h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><ol>
<li>æŸ¥è¯¢ï¼š<ul>
<li>Selectï¼›Whereï¼›Distinctï¼›Andï¼›Or</li>
</ul>
</li>
<li>å»ºè¡¨ã€åˆ è¡¨ã€åˆ†åŒºï¼š<ul>
<li>Create tableï¼›Drop tableï¼›Insert intoï¼›Partition by</li>
</ul>
</li>
<li>è¡¨è¿æ¥ï¼š<ul>
<li>å¸¸ç”¨å››ç±»joinæ“ä½œï¼š</li>
<li>[inner] joinï¼›Left joinï¼›Right joinï¼›Full join</li>
</ul>
</li>
<li>å‡½æ•°ï¼š<ul>
<li>èšåˆå‡½æ•°ï¼›æ—¥æœŸå‡½æ•°ï¼›æ•°å­—ç±»å‡½æ•°ï¼›å­—ç¬¦ç±»å‡½æ•°</li>
</ul>
</li>
<li>åµŒå¥—ã€åˆ†ç»„ã€æ’åºï¼š<ul>
<li>åŒé‡whereï¼›Group byï¼›Order by</li>
</ul>
</li>
<li>SQLä¸‰èŒƒå¼&amp;æ³¨æ„äº‹é¡¹ï¼š<ol>
<li>ä¸‰èŒƒå¼<ol>
<li>ä¿è¯æ¯åˆ—çš„åŸå­æ€§</li>
<li>æ¯åˆ—å‡ä¸ä¸»é”®ç›¸å…³</li>
<li>æ¯åˆ—å‡ä¸ä¸»é”®ç›´æ¥ç›¸å…³</li>
</ol>
</li>
<li>æ³¨æ„äº‹é¡¹<ol>
<li>å°è¡¨æ‹¼å¤§è¡¨</li>
<li>å…ˆè¿‡æ»¤å†æ‹¼è¡¨</li>
<li>é¿å…è¿‡åº¦åµŒå¥—</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><p>Select åˆ—åç§° from è¡¨åç§° where åˆ— è¿ç®—ç¬¦ è¡¨åç§°</p>
<p>è¿ç®—ç¬¦ï¼š&#x3D;, &gt;, &lt;, &gt;&#x3D;, &lt;&#x3D;, <strong>&lt;&gt;, !&#x3D;</strong>, between, like, <strong>in, %, is</strong> <strong>null, is not null</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="operator">*</span> <span class="keyword">from</span> edw_cdm.dim_trx_loan <span class="keyword">where</span> dt <span class="keyword">in</span> (â€˜<span class="number">2021</span><span class="number">-02</span><span class="number">-28</span>â€™,â€™<span class="number">2021</span><span class="number">-03</span><span class="number">-31</span>â€™); <span class="comment">--å–æœˆæœ«æ•°æ®</span></span><br><span class="line"><span class="comment">-- dt&lt;=&#x27;2025-09-30&#x27; and cast(dt as date)=last_day_of_month(cast(dt as date))</span></span><br></pre></td></tr></table></figure>

<ol>
<li>æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆç›´æ¥æ¯”ï¼‰</li>
</ol>
<ul>
<li>é€‚ç”¨ï¼šæ•°å€¼ã€æ—¥æœŸã€å­—ç¬¦ä¸²çš„ç­‰äº &#x2F; ä¸ç­‰äº &#x2F; å¤§å°æ¯”è¾ƒã€‚</li>
<li>å…³é”®ç¬¦å·ï¼š<code>=</code>ï¼ˆç­‰äºï¼‰ã€<code>&gt;</code>&#x2F;<code>&lt;</code>ï¼ˆå¤§äº &#x2F; å°äºï¼‰ã€<code>&gt;=</code>&#x2F;<code>&lt;=</code>ï¼ˆå¤§äºç­‰äº &#x2F; å°äºç­‰äºï¼‰ã€<code>&lt;&gt;</code>&#x2F;<code>!=</code>ï¼ˆä¸ç­‰äºï¼‰ã€‚</li>
</ul>
<ol>
<li>èŒƒå›´è¿ç®—ç¬¦ï¼ˆåœˆèŒƒå›´ï¼‰</li>
</ol>
<ul>
<li><code>between ... and</code>ï¼šå–è¿ç»­èŒƒå›´ï¼ˆå«è¾¹ç•Œï¼‰ï¼Œå¦‚ â€œscore between 80 and 90â€ã€‚</li>
<li><code>in (å€¼1,å€¼2)</code>ï¼šå–ç¦»æ•£å€¼åˆ—è¡¨ï¼Œå¦‚ â€œaddress in (â€˜ åŒ—äº¬ â€˜,â€™ ä¸Šæµ· â€˜)â€ï¼›åŠ <code>no</code>tåˆ™æ’é™¤ã€‚</li>
</ul>
<ol>
<li>æ¨¡ç³ŠåŒ¹é…ï¼ˆæŸ¥éƒ¨åˆ†ï¼‰</li>
</ol>
<ul>
<li>ä»…ç”¨äºå­—ç¬¦ä¸²ï¼Œéœ€æ­é…<code>%</code>ï¼ˆä»»æ„å­—ç¬¦ï¼‰æˆ–<code>_</code>ï¼ˆå•ä¸ªå­—ç¬¦ï¼‰ã€‚</li>
<li>ç¤ºä¾‹ï¼š<code>name like &#39;å¼ %&#39;</code>ï¼ˆå§“å¼ ï¼‰ã€<code>name like &#39;%æ™“%&#39;</code>ï¼ˆå« â€œæ™“â€ å­—ï¼‰ã€‚</li>
</ul>
<ol>
<li>ç©ºå€¼åˆ¤æ–­ï¼ˆåˆ¤ç©ºå€¼ï¼‰</li>
</ol>
<ul>
<li>ä¸èƒ½ç”¨<code>=</code>ï¼Œå¿…é¡»ç”¨<code>is null</code>ï¼ˆä¸ºç©ºï¼‰æˆ–<code>is not null</code>ï¼ˆä¸ä¸ºç©ºï¼‰ï¼Œå¦‚ â€œaddress is nullâ€ã€‚</li>
</ul>
<ol>
<li>ç»„åˆé€»è¾‘ï¼ˆå¤šæ¡ä»¶ï¼‰</li>
</ol>
<ul>
<li>ç”¨<code>and</code>ï¼ˆåŒæ—¶æ»¡è¶³ï¼‰æˆ–<code>or</code>ï¼ˆæ»¡è¶³ä¸€ä¸ªï¼‰ç»„åˆæ¡ä»¶ï¼Œå¦‚ â€œage&gt;18 AND score&gt;80â€ã€‚</li>
</ul>
<h3 id="å»ºè¡¨ã€åˆ è¡¨ã€åˆ†åŒº"><a href="#å»ºè¡¨ã€åˆ è¡¨ã€åˆ†åŒº" class="headerlink" title="å»ºè¡¨ã€åˆ è¡¨ã€åˆ†åŒº"></a>å»ºè¡¨ã€åˆ è¡¨ã€åˆ†åŒº</h3><p>create table è¡¨åç§° (åˆ—åç§°1 æ•°æ®ç±»å‹, åˆ—åç§°2 æ•°æ®ç±»å‹, åˆ—åç§°3 æ•°æ®ç±»å‹â€¦)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> sql_grammar_cust_base</span><br><span class="line">    (cust_id  string  comment  â€˜å®¢æˆ·å·â€™ï¼Œ<span class="comment">--comment ä¸ºæ·»åŠ æ³¨é‡Š</span></span><br><span class="line">     fst_crd_cls_dt    string  comment  â€˜é¦–æ¬¡æˆä¿¡æ—¥æœŸâ€™ï¼Œ</span><br><span class="line">     fst_crd_base_lvl_busiclass  string  comment â€˜é¦–æ¬¡æˆä¿¡ä¸šåŠ¡åŸºç¡€ç»´åº¦â€™) </span><br><span class="line">partitioned <span class="keyword">by</span> (dt  string  comment â€™æ—¥æœŸâ€™)ï¼›</span><br></pre></td></tr></table></figure>

<p><code>partitioned by</code><strong>æ³¨ï¼šåˆ†åŒºå¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œå¹¶ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ï¼Œå†™ä»£ç æ—¶æ³¨æ„é™åˆ¶åˆ†åŒºå­—æ®µ</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> aaa_tmp;</span><br><span class="line"><span class="keyword">create table</span> aaa_tmp <span class="keyword">as</span></span><br></pre></td></tr></table></figure>



<h4 id="åˆ†åŒºå’Œéåˆ†åŒºçš„åŒºåˆ«"><a href="#åˆ†åŒºå’Œéåˆ†åŒºçš„åŒºåˆ«" class="headerlink" title="åˆ†åŒºå’Œéåˆ†åŒºçš„åŒºåˆ«"></a>åˆ†åŒºå’Œéåˆ†åŒºçš„åŒºåˆ«</h4><p>é€»è¾‘ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œä¸»è¦åŒºåˆ«åœ¨äº<strong>ç‰©ç†å­˜å‚¨</strong>ä¸Šï¼Œ hiveè¡¨çš„æ•°æ®ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨ï¼Œåˆ†åŒºè¡¨æŒ‰ç…§åˆ†åŒºåˆ—çš„å€¼åˆ†åˆ«å­˜å‚¨ï¼Œ<strong>ä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªç›®å½•</strong>ï¼Œéåˆ†åŒºè¡¨åªæœ‰ä¸€ä¸ªç›®å½•ã€‚</p>
<p>åˆ†åŒºçš„ç›®çš„æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡å’Œå›æº¯å†å²çŠ¶æ€ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼š</p>
<ul>
<li><strong>æé«˜æŸ¥è¯¢æ•ˆç‡</strong>ã€‚å¦‚æœæ²¡æœ‰åˆ†åŒºï¼Œæ¯æ¬¡å…¨è¡¨æ‰«æï¼Œå¯¹äºæ•°æ®é‡å¤§çš„è¡¨æŸ¥è¯¢æ•ˆç‡ä½ä¸‹ï¼Œåˆ†åŒºè¡¨é€šè¿‡é™åˆ¶åˆ†åŒºï¼Œåªéœ€æ‰«æéƒ¨åˆ†åˆ†åŒºæ•°æ®ï¼Œå¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li>
<li><strong>å›æº¯å†å²çŠ¶æ€</strong>ã€‚Hiveåˆ†åŒºè¡¨å¤§éƒ¨åˆ†é€šè¿‡å¢é‡+å…¨é‡çš„æ–¹å¼æ›´æ–°ï¼Œå¦‚æœå½“å¤©çš„æ•°æ®å‡ºé”™ï¼Œå¯ä»¥é€šè¿‡å‰ä¸€å¤©çš„åˆ†åŒºå¿«é€Ÿä¿®å¤ï¼›é€šè¿‡è®°å½•æœˆæœ«å¿«ç…§åˆ†åŒºï¼Œå¯ä»¥å›æº¯å†å²çŠ¶æ€ï¼Œå¯ç”¨äºåˆ†æå’Œå®šä½é—®é¢˜ã€‚</li>
</ul>
<blockquote>
<p>100ä¸ªçƒï¼Œ10ç§é¢œè‰²ï¼Œå„æœ‰10ä¸ªï¼Œç¼–å·1-10</p>
<ul>
<li>éåˆ†åŒºè¡¨ï¼šæ‰€æœ‰çƒè£…åœ¨ä¸€ä¸ªå¤§è¢‹å­é‡Œ</li>
<li>åˆ†åŒºè¡¨ï¼šæ¯ç§é¢œè‰²çš„çƒåˆ†åˆ«è£…åœ¨å¯¹åº”é¢œè‰²çš„å°è¢‹å­é‡Œï¼Œç„¶åå†è£…åˆ°å¤§è¢‹å­é‡Œ</li>
</ul>
<p>éœ€æ±‚ï¼šæ‰¾å‡ºç™½è‰²3å·çƒ</p>
<ul>
<li>éåˆ†åŒºè¡¨ï¼šå…¨è¡¨æ‰«æï¼Œä»100ä¸ªçƒä¸­æ‰¾å‡ºç™½è‰²3å·çƒ</li>
<li>åˆ†åŒºè¡¨ï¼šå±€éƒ¨æ‰«æï¼Œä»ç™½</li>
<li>è‰²å°è¢‹å­é‡Œæ‰¾ï¼Œä»10ä¸ªçƒä¸­æ‰¾å‡ºç™½è‰²3å·çƒ</li>
</ul>
</blockquote>
<h3 id="è¡¨è¿æ¥"><a href="#è¡¨è¿æ¥" class="headerlink" title="è¡¨è¿æ¥"></a>è¡¨è¿æ¥</h3><p><img src="/./../%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/70a34cbd-ad2b-4eae-8a7b-31d8da835f79.png" alt="SQL JOINS"></p>
<p>âœ… <strong>æ€»ç»“è®°å¿†å£è¯€</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>join ç±»å‹</th>
<th>è¿”å›ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>inner join</td>
<td>ä¸¤è¡¨äº¤é›†</td>
</tr>
<tr>
<td>left join</td>
<td>å·¦è¡¨å…¨é‡ + å³è¡¨åŒ¹é…</td>
</tr>
<tr>
<td>right join</td>
<td>å³è¡¨å…¨é‡ + å·¦è¡¨åŒ¹é…</td>
</tr>
<tr>
<td>full outer join</td>
<td>ä¸¤è¡¨å¹¶é›†ï¼ˆå«æ‰€æœ‰è®°å½•ï¼‰</td>
</tr>
<tr>
<td>left&#x2F;right join + where null</td>
<td>ä»…è¿”å›å·¦&#x2F;å³è¡¨ç‹¬æœ‰çš„è®°å½•</td>
</tr>
<tr>
<td>full outer join + where null</td>
<td>ä»…è¿”å›ä¸¤è¡¨ä¸­ä¸åŒ¹é…çš„è®°å½•ï¼ˆå¯¹ç§°å·®ï¼‰</td>
</tr>
</tbody></table>
<p>ğŸ“Œ <strong>æç¤º</strong>ï¼š</p>
<ul>
<li>å®é™…ä½¿ç”¨ä¸­ï¼Œ<code>inner join</code> æœ€å¸¸ç”¨ã€‚</li>
<li><code>left join</code> å¸¸ç”¨äºâ€œä¸»è¡¨ + å…³è”è¡¨â€çš„åœºæ™¯ï¼ˆå¦‚è®¢å• + ç”¨æˆ·ä¿¡æ¯ï¼‰ã€‚</li>
<li><code>left join ... where b.key is null</code>ï¼ˆå·¦å¤–è¿æ¥æ’é™¤å†…è¿æ¥ï¼‰ä¹Ÿå¸¸ç”¨ã€‚</li>
<li><code>full outer join</code> åœ¨æŸäº›åˆ†æåœºæ™¯æœ‰ç”¨ï¼Œä½†æ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚</li>
<li>ä½¿ç”¨ <code>where ... is null</code> æ˜¯ç­›é€‰â€œæ— åŒ¹é…è®°å½•â€çš„å…³é”®æŠ€å·§ã€‚</li>
</ul>
<p><strong>å›¾ä¸­æ¶‰åŠçš„ JOIN ç±»å‹ï¼š</strong></p>
<ol>
<li><p><strong>left joinï¼ˆå·¦è¿æ¥ï¼‰</strong></p>
<ul>
<li><p><strong>å›¾ç¤º</strong>ï¼šçº¢è‰²åŒºåŸŸåŒ…æ‹¬ <code>A</code> çš„å…¨éƒ¨ + <code>A âˆ© B</code></p>
</li>
<li><pre><code class="language-SQL">select &lt;select_list&gt; from table a left join table b on a.key = b.key
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - **å«ä¹‰**ï¼šè¿”å›å·¦è¡¨ï¼ˆtableaï¼‰çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠå³è¡¨ï¼ˆtablebï¼‰ä¸­åŒ¹é…çš„è®°å½•ã€‚å¦‚æœå³è¡¨æ— åŒ¹é…ï¼Œåˆ™å¯¹åº”å­—æ®µä¸º `null`ã€‚</span><br><span class="line"></span><br><span class="line">2. **inner joinï¼ˆå†…è¿æ¥ï¼‰**</span><br><span class="line"></span><br><span class="line">   - **å›¾ç¤º**ï¼šä»…çº¢è‰²åŒºåŸŸä¸º `A âˆ© B`ï¼ˆäº¤é›†ï¼‰</span><br><span class="line"></span><br><span class="line">   - ```SQL</span><br><span class="line">     select &lt;select_list&gt; from table a inner join table b on a.key = b.key</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼šåªè¿”å›ä¸¤ä¸ªè¡¨ä¸­<strong>é”®å€¼åŒ¹é…</strong>çš„è®°å½•ï¼Œå³äº¤é›†éƒ¨åˆ†ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>right joinï¼ˆå³è¿æ¥ï¼‰</strong></p>
<ul>
<li><p><strong>å›¾ç¤º</strong>ï¼šçº¢è‰²åŒºåŸŸåŒ…æ‹¬ <code>B</code> çš„å…¨éƒ¨ + <code>A âˆ© B</code></p>
</li>
<li><pre><code class="language-SQL">select &lt;select_list&gt; from table a right join table b on a.key = b.key
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - **å«ä¹‰**ï¼šè¿”å›å³è¡¨ï¼ˆtablebï¼‰çš„æ‰€æœ‰è®°å½•ï¼Œä»¥åŠå·¦è¡¨ï¼ˆtableaï¼‰ä¸­åŒ¹é…çš„è®°å½•ã€‚å¦‚æœå·¦è¡¨æ— åŒ¹é…ï¼Œåˆ™å¯¹åº”å­—æ®µä¸º `null`ã€‚</span><br><span class="line"></span><br><span class="line">4. **left join ... where b.key is** **nullï¼ˆå·¦å¤–è¿æ¥æ’é™¤å†…è¿æ¥ï¼‰**</span><br><span class="line"></span><br><span class="line">   - **å›¾ç¤º**ï¼šçº¢è‰²åŒºåŸŸä»…ä¸º `A - (A âˆ© B)`ï¼ˆå·¦è¡¨ç‹¬æœ‰éƒ¨åˆ†ï¼‰</span><br><span class="line"></span><br><span class="line">   - ```SQL</span><br><span class="line">     select &lt;select_list&gt;from table a left join table b on a.key = b.key</span><br><span class="line">     where b.key is null</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼šè¿”å›å·¦è¡¨ä¸­<strong>æ²¡æœ‰åœ¨å³è¡¨ä¸­æ‰¾åˆ°åŒ¹é…</strong>çš„è®°å½•ï¼Œå¸¸ç”¨äºæŸ¥æ‰¾â€œå­¤å„¿è®°å½•â€ã€‚</p>
</li>
</ul>
</li>
<li><p><strong>full outer joinï¼ˆå…¨å¤–è¿æ¥ï¼‰</strong></p>
<ul>
<li><p><strong>å›¾ç¤º</strong>ï¼šçº¢è‰²åŒºåŸŸä¸º <code>A âˆª B</code>ï¼ˆå¹¶é›†ï¼‰ï¼Œå³ä¸¤ä¸ªè¡¨çš„æ‰€æœ‰è®°å½•</p>
</li>
<li><pre><code class="language-SQL">select &lt;select_list&gt;from table a full outer join table b on a.key = b.key
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   - **å«ä¹‰**ï¼šè¿”å›ä¸¤ä¸ªè¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</span><br><span class="line"></span><br><span class="line">   - è‹¥æŸä¸€ä¾§æ— åŒ¹é…ï¼Œåˆ™è¯¥ä¾§å¯¹åº”å­—æ®µä¸º `null`ã€‚</span><br><span class="line"></span><br><span class="line">6. **full outer join ... where a.key is** **null** **or b.key is nullï¼ˆå…¨å¤–è¿æ¥æ’é™¤å†…è¿æ¥ï¼‰**</span><br><span class="line"></span><br><span class="line">   - **å›¾ç¤º**ï¼šçº¢è‰²åŒºåŸŸä¸º `(A - B) âˆª (B - A)`ï¼ˆå¯¹ç§°å·®é›†ï¼‰</span><br><span class="line"></span><br><span class="line">   - ```SQL</span><br><span class="line">     select &lt;select_list&gt; from table a full outer join table b on a.key = b.key</span><br><span class="line">     where a.key is null or b.key is null</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼šè¿”å›<strong>ä»…åœ¨ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨</strong>çš„è®°å½•ï¼Œå³ä¸¤ä¸ªè¡¨ä¸­ä¸åŒ¹é…çš„éƒ¨åˆ†ã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><table>
<thead>
<tr>
<th>èšåˆå‡½æ•°</th>
<th>æ—¥æœŸå‡½æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>æ±‚å’Œ<code>sum()</code> <br />æ±‚å‡å€¼<code>avg()</code> <br />è®¡æ•°<code>count()</code> <br />æ±‚æœ€å¤§å€¼<code>max()</code> <br />æ±‚æœ€å°å€¼<code>min()</code> <br /><strong>æ³¨æ„ï¼šnullå€¼ä¸åŒ…å«åœ¨è®¡ç®—ä¸­</strong> <br />ä¾‹ï¼šäººå‡VSæœ‰è´·äººå‡æ˜¯å¦å“åº”</td>
<td>è¿”å›æ—¥æœŸåŠ ä¸ŠæŒ‡å®šå¤©æ•°çš„ç»“æœï¼š<code>date_add(date, n)</code> <br />è¿”å›æ—¥æœŸåŠ ä¸ŠæŒ‡å®šæœˆçš„ç»“æœï¼š<code>add_months(date, n)</code> <br />è¿”å›ä¸¤ä¸ªæ—¥æœŸçš„å·®ï¼š<code>datediff(date1, date2)</code>(å¤‡æ³¨date1-date2) <br />è¿”å›ä¸¤ä¸ªæ—¥æœŸçš„æœˆä»½å·®ï¼š<code>months_between(date1, date2)</code> <br />è¿”å›è¿™ä¸ªæœˆæœ«çš„æ—¥æœŸï¼š<strong><code>last_day(date)</code></strong> <br />ä¾‹ï¼šåˆ†åŒºè¡¨é™åˆ¶<code>dt=last_day(&#39;2025-04-19&#39;)</code></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>æ•°å­—ç±»å‡½æ•°</th>
<th>å­—ç¬¦ç±»å‡½æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>æ±‚ç»å¯¹å€¼<code>abs()</code><br />å‘ä¸Šå–æ•´<code>ceil(n)</code><br />å‘ä¸‹å–æ•´<code>floor(n)</code><br />å››èˆäº”å…¥<code>round(n, len)</code><br />æ±‚æŒ‡æ•°å€¼<code>exp(n)</code><br />æ±‚å¯¹æ•°å€¼<code>log(n)</code><br />æ±‚æ­£å¼¦å€¼<code>sin(n)</code><br />æ±‚ä½™å¼¦å€¼<code>cos(n)</code></td>
<td>æ±‚é•¿åº¦<code>length(n)</code><br /><strong>å­—ç¬¦ä¸²æˆªå–<code>substr(s, start, [length])&lt;br /&gt;</code></strong><br />å­—ç¬¦ä¸²æ‹¼æ¥<code>concat(s1, s2)&lt;br /&gt;</code><br />å­—ç¬¦ä¸²æ›¿æ¢<code>replace(S1, s1, S2)&lt;br /&gt;</code><br />åˆ‡å‰²å‡½æ•°<code>split_part(s,delimiter,field)</code><br />split_part(å­—æ®µï¼Œåˆ†éš”ç¬¦ï¼Œ<strong>å­ä¸²ä½ç½®ï¼ˆä»1å¼€å§‹è®¡æ•°ï¼‰</strong>)</td>
</tr>
</tbody></table>
<h3 id="åµŒå¥—ã€åˆ†ç»„ã€æ’åº"><a href="#åµŒå¥—ã€åˆ†ç»„ã€æ’åº" class="headerlink" title="åµŒå¥—ã€åˆ†ç»„ã€æ’åº"></a>åµŒå¥—ã€åˆ†ç»„ã€æ’åº</h3><ol>
<li><p>åµŒå¥—</p>
<p>select * from sql_grammar_cust_base where cust_id in  (select cust_id from sql_grammar_lon_base);  â€“ä¸åŠ t</p>
<p>Select * from (select cust_id from sql_grammar_lon_base) t;  â€“åŠ t</p>
<ul>
<li>åœ¨ PB çº§åœºæ™¯ä¸‹ï¼Œå»ºè®®ç›´æ¥ç”¨<code>JOIN</code>æ›¿ä»£<code>IN</code>å­æŸ¥è¯¢ï¼Œæ•ˆç‡æ›´ç¨³å®š</li>
<li>åœ¨ SQL ä¸­ï¼Œ<code>JOIN</code>ï¼ˆé»˜è®¤æŒ‡<code>INNER JOIN</code>ï¼Œå†…è¿æ¥ï¼‰</li>
</ul>
<p>è¯¦ç»†è§£æï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼ˆ<code>IN</code>å­æŸ¥è¯¢ï¼Œä¸åŠ åˆ«åï¼‰</li>
</ul>
<p>ç‰¹ç‚¹ï¼š</p>
<p> <code>IN</code>å­æŸ¥è¯¢ä¸éœ€è¦åˆ«åï¼Œå› ä¸ºå®ƒä½œä¸ºå€¼åˆ—è¡¨ç›´æ¥å‚ä¸æ¡ä»¶åˆ¤æ–­ã€‚</p>
<p> æ•°æ®åº“ä¼šè‡ªåŠ¨å¤„ç†å­æŸ¥è¯¢ç»“æœä¸å¤–éƒ¨æ¡ä»¶çš„å…³è”ã€‚</p>
<ul>
<li>ç¬¬äºŒä¸ªæŸ¥è¯¢ï¼ˆæ´¾ç”Ÿè¡¨å­æŸ¥è¯¢ï¼Œå¿…é¡»åŠ åˆ«åï¼‰</li>
</ul>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>è¯¥ä¸´æ—¶è¡¨å¿…é¡»æŒ‡å®šåˆ«åï¼ˆè¿™é‡Œæ˜¯ <code>t</code>ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥è¯­æ³•é”™è¯¯ã€‚</li>
<li>æ´¾ç”Ÿè¡¨ï¼ˆDerived Tableï¼‰æ˜¯å®Œæ•´çš„ä¸´æ—¶ç»“æœé›†ï¼Œå¿…é¡»é€šè¿‡åˆ«åå¼•ç”¨ã€‚</li>
<li>å¸¸ç”¨äºå¤æ‚æŸ¥è¯¢ä¸­çš„ä¸­é—´æ­¥éª¤ã€‚</li>
</ul>
</li>
<li><p>åˆ†ç»„</p>
<p>group by</p>
<p>ä¸èšåˆå‡½æ•°æ­é…ä½¿ç”¨</p>
<p>èšåˆå‡½æ•°ï¼ˆå¦‚ <code>SUM</code>, <code>AVG</code>, <code>COUNT</code>, <code>MAX</code>, <code>MIN</code>ï¼‰</p>
</li>
<li><p>æ’åº</p>
</li>
</ol>
<p>Select åˆ— from è¡¨ order by åˆ— asc&#x2F;desc</p>
<ul>
<li><p>select * from (select cust_id, lvl1_bus_cls_nm, row_number() over(partition by  lvl1_bus_cls_nm <strong>order by rand()</strong> ) rn from sql_grammar_cust_base_lon) t where (lvl1_bus_cls_nm&#x3D;â€˜æ‹›è¡Œâ€™ and rn&lt;&#x3D;10000) or (lvl1_bus_cls_nm&#x3D;â€˜å¥½æœŸè´·ç”Ÿæ´»å·â€™  and rn&lt;&#x3D;20000); â€“æ€»å®¢ç¾¤3wäººï¼Œæ‹›è¡Œ1wäººï¼Œç”Ÿæ´»å·2wäºº</p>
</li>
<li><p>è¯¦è§£ï¼š</p>
</li>
<li><p>æŒ‰å®¢ç¾¤éšæœºæŠ½æ ·ï¼ˆæ‹›è¡Œ1wäººï¼Œç”Ÿæ´»å·2wäººï¼Œå…±3wäºº</p>
<ul>
<li><p>éšæœºå‡½æ•°å·®å¼‚ï¼š</p>
<ul>
<li>MySQLï¼š<code>order by rand()</code></li>
<li>PostgreSQLï¼š<code>order by random()</code></li>
<li>SQL Serverï¼š<code>order by newid()</code>ï¼ˆç”ŸæˆéšæœºGUIDæ’åºï¼‰</li>
<li>Oracleï¼š<code>order by dbms_random.value()</code></li>
</ul>
</li>
<li><p>æ½œåœ¨é—®é¢˜ï¼š</p>
<ul>
<li><code>ORDER BY RAND()</code> åœ¨å¤§æ•°æ®é‡æ—¶æ€§èƒ½æå·®ï¼ˆéœ€å…¨è¡¨æ‰«æå¹¶æ’åºï¼‰ã€‚</li>
</ul>
</li>
<li><p>æ€§èƒ½ä¼˜åŒ–ï¼š</p>
<ul>
<li><p><code>rand()</code> åœ¨å¤§æ•°æ®é‡è¡¨ä¸­æ•ˆç‡ä½ï¼ˆéœ€å…¨è¡¨æ‰«æå¹¶ç”Ÿæˆéšæœºæ•°ï¼‰ï¼Œå¯å…ˆç¼©å°èŒƒå›´å†æŠ½æ ·</p>
</li>
<li><pre><code class="language-sql">select * 
from (
  select 
    cust_id
    ,lvl1_bus_cls_nm
    ,row_number() over(partition by lvl1_bus_cls_nm order by rand()) rn  -- æŒ‰å®¢ç¾¤åˆ†ç»„ï¼Œéšæœºæ’åºç¼–å·
  from sql_grammar_cust_base_lon
) t 
where 
  (lvl1_bus_cls_nm = &#39;æ‹›è¡Œ&#39; and rn &lt;= 10000) or  -- æ‹›è¡Œå®¢ç¾¤å–å‰1wäºº
  (lvl1_bus_cls_nm = &#39;å¥½æœŸè´·ç”Ÿæ´»å·&#39; and rn &lt;= 20000);  -- ç”Ÿæ´»å·å®¢ç¾¤å–å‰2wäºº
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  - SQLåŠŸèƒ½</span><br><span class="line"></span><br><span class="line">    - æŒ‰æ¡ä»¶éšæœºæŠ½æ ·</span><br><span class="line"></span><br><span class="line">  - æ ¸å¿ƒå‡½æ•°/è¯­æ³•</span><br><span class="line"></span><br><span class="line">    - Order by rand() + row_number() + where ç­›é€‰</span><br><span class="line"></span><br><span class="line">  - å…¸å‹åœºæ™¯</span><br><span class="line"></span><br><span class="line">    - å®¢ç¾¤åˆ†å±‚æŠ½æ ·ã€ABæµ‹è¯•æ ·æœ¬é€‰å–</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## ä¸‰èŒƒå¼</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ³¨ï¼šhiveä½¿ç”¨çš„æ˜¯ä¸€ç§ç±»SQLè¯­è¨€ï¼Œæ²¡æœ‰æ‰€è°“çš„ä¸»é”®ï¼Œä¹Ÿä¸éœ€è¦æ»¡è¶³çš„æ ‡å‡†çš„SQLä¸‰èŒƒå¼ï¼Œä½†æ˜¯åœ¨è¯­æ³•ä¸Šä¸SQLåŸºæœ¬ä¸€è‡´</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## æ³¨æ„äº‹é¡¹</span><br><span class="line"></span><br><span class="line">| **å°è¡¨æ‹¼å¤§è¡¨**   | æˆ‘ä»¬å¸¸ç”¨çš„Left joinæ˜¯ä»å³è¡¨æ‰¾å·¦ç´¢å¼•çš„ï¼Œå·¦è¡¨å°çš„è¯æœç´¢æ¬¡æ•°å°‘ï¼Œæ•ˆç‡é«˜ |</span><br><span class="line">| ---------------- | ------------------------------------------------------------ |</span><br><span class="line">| **å…ˆè¿‡æ»¤å†æ‹¼è¡¨** | æ‹¼è¡¨ä¹‹å‰å…ˆåŠ whereé™åˆ¶ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å­è¡¨ï¼Œå‡å°‘æ¯ä¸ªé˜¶æ®µçš„æ•°æ®é‡ |</span><br><span class="line">| **é¿å…è¿‡å¤šåµŒå¥—** | é¿å…ä¸€æ®µä»£ç åµŒå¥—å¤ªå¤šé€»è¾‘ï¼Œå¤šä½¿ç”¨ä¸­é—´è¡¨æ¥å®Œæˆ                 |</span><br><span class="line"></span><br><span class="line">&#123;% tabs 1 %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab å°è¡¨æ‹¼å¤§è¡¨ --&gt;</span><br><span class="line"></span><br><span class="line">**æˆ‘ä»¬å¸¸ç”¨çš„Left joinæ˜¯ä»å³è¡¨æ‰¾å·¦ç´¢å¼•çš„ï¼Œå·¦è¡¨å°çš„è¯æœç´¢æ¬¡æ•°å°‘ï¼Œæ•ˆç‡é«˜**</span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab å…ˆè¿‡æ»¤å†æ‹¼è¡¨ --&gt;</span><br><span class="line"></span><br><span class="line">**æ‹¼è¡¨ä¹‹å‰å…ˆåŠ whereé™åˆ¶ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å­è¡¨ï¼Œå‡å°‘æ¯ä¸ªé˜¶æ®µçš„æ•°æ®é‡**</span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab é¿å…è¿‡å¤šåµŒå¥—--&gt;</span><br><span class="line"></span><br><span class="line">**é¿å…ä¸€æ®µä»£ç åµŒå¥—å¤ªå¤šé€»è¾‘ï¼Œå¤šä½¿ç”¨ä¸­é—´è¡¨æ¥å®Œæˆ**</span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## SQLçš„è§„èŒƒä¸ä¼˜åŒ–</span><br><span class="line"></span><br><span class="line">### å¸¸è§çš„SQLä¸è§„èŒƒç±»å‹</span><br><span class="line"></span><br><span class="line">1. å…¨é‡åˆ†åŒºè¡¨æ²¡æœ‰åŠ åˆ†åŒºé™åˆ¶</span><br><span class="line"></span><br><span class="line">   - `where`é™åˆ¶dtï¼Œé¿å…ä¸å¿…è¦çš„å…¨åˆ†åŒºæ‰«æï¼Œå…»æˆé™åˆ¶åˆ†åŒºçš„å¥½ä¹ æƒ¯ï¼›é¿å…æ— æ„ä¹‰å­—æ®µçš„è¿”å›ï¼Œå¯ä»¥æœ‰æ•ˆæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</span><br><span class="line">   - `udf.getmaxpar` é€šå¸¸æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼ŒUser-Defined Functionï¼‰ï¼Œä»å‘½åæ¨æµ‹å…¶åŠŸèƒ½å¯èƒ½æ˜¯ â€œè·å–æŸä¸ªå‚æ•°ï¼ˆParameterï¼‰çš„æœ€å¤§å€¼â€</span><br><span class="line">   - é¿å… `SELECT *`ï¼šåªæŸ¥éœ€è¦çš„åˆ—</span><br><span class="line"></span><br><span class="line">2. ç¬›å¡å°”ç§¯ç›¸å…³</span><br><span class="line"></span><br><span class="line">   - å¤šè¡¨å…³è”æ—¶æ¼å†™éƒ¨åˆ†å…³è”æ¡ä»¶ï¼ˆæ—  ON æ¡ä»¶ï¼‰</span><br><span class="line">   - **è§„èŒƒå†™æ³•**ï¼šæ˜ç¡®æ¯ä¸¤å¼ è¡¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œç¡®ä¿å…³è”æ¡ä»¶é€»è¾‘æ­£ç¡®ï¼Œå¿…è¦æ—¶é€šè¿‡ä¸šåŠ¡ä¸»é”®ï¼ˆå¦‚ user_idã€order_idï¼‰å…³è”ã€‚</span><br><span class="line">   - ç¬›å¡å°”ç§¯å…³è”çš„æ•°æ®é‡æ˜¯N*Mï¼Œå°½é‡é¿å…ä½¿ç”¨ç¬›å¡å°”ç§¯å…³è”</span><br><span class="line"></span><br><span class="line">3. ç´¢å¼•åˆ— / åˆ†åŒºåˆ—ä¸Šä½¿ç”¨å‡½æ•°</span><br><span class="line"></span><br><span class="line">   - **ä¸è§„èŒƒè¡¨ç°**ï¼š</span><br><span class="line">     - æ•°æ®åº“ï¼š`SELECT * FROM user WHERE SUBSTR(phone, 1, 3) = &#x27;138&#x27;;`ï¼ˆphone ä¸ºç´¢å¼•åˆ—ï¼Œä½¿ç”¨äº† SUBSTR å‡½æ•°ï¼‰</span><br><span class="line">     - æ•°ä»“ï¼š`SELECT * FROM dwd_order_di WHERE DATE_FORMAT(dt, &#x27;yyyy-MM&#x27;) = &#x27;2024-01&#x27;;`ï¼ˆdt ä¸ºåˆ†åŒºåˆ—ï¼Œä½¿ç”¨äº† DATE_FORMAT å‡½æ•°ï¼‰</span><br><span class="line">   - **æ ¸å¿ƒå½±å“**ï¼šæ•°æ®åº“æ— æ³•ä½¿ç”¨ phone åˆ—çš„ç´¢å¼•ï¼Œæ•°ä»“æ— æ³•ä¸‹æ¨åˆ†åŒºè¿‡æ»¤ï¼Œå‡ä¼šè§¦å‘å…¨è¡¨ / å…¨åˆ†åŒºæ‰«æã€‚</span><br><span class="line">   - **è§„èŒƒå†™æ³•**ï¼š**å°†å‡½æ•°é€»è¾‘è½¬ç§»åˆ°ç­‰å·å³ä¾§**ï¼š</span><br><span class="line">     - æ•°æ®åº“ï¼š`SELECT * FROM user WHERE phone LIKE &#x27;138%&#x27;;`</span><br><span class="line">     - æ•°ä»“ï¼š`SELECT * FROM dwd_order_di WHERE dt BETWEEN &#x27;20240101&#x27; AND &#x27;20240131&#x27;;`</span><br><span class="line"></span><br><span class="line">4. éšå¼ç±»å‹è½¬æ¢</span><br><span class="line"></span><br><span class="line">   - **ä¸è§„èŒƒè¡¨ç°**ï¼š`SELECT * FROM order WHERE order_id = 123456;`ï¼ˆorder_id å®é™…ä¸º VARCHAR ç±»å‹ï¼Œä¼ å…¥äº†æ•°å€¼ 123456ï¼‰</span><br><span class="line">   - **æ ¸å¿ƒå½±å“**ï¼šæ•°æ®åº“ä¼šå¯¹æ¯ä¸€è¡Œçš„ order_id è¿›è¡Œ`CAST(order_id AS INT)`è½¬æ¢ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè§¦å‘å…¨è¡¨æ‰«æã€‚</span><br><span class="line">   - **è§„èŒƒå†™æ³•**ï¼šç¡®ä¿ä¼ å…¥çš„å‚æ•°ç±»å‹ä¸è¡¨å­—æ®µç±»å‹ä¸€è‡´ï¼Œå¦‚ `WHERE order_id = &#x27;123456&#x27;;`</span><br><span class="line"></span><br><span class="line">5. ç›¸å…³å­æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">   - **å¤–å±‚æ¯ä¸€è¡Œéƒ½è§¦å‘ä¸€æ¬¡****å­æŸ¥è¯¢**</span><br><span class="line"></span><br><span class="line">     - `SELECT a.user_id, (SELECT b.name FROM user b WHERE b.id = a.user_id) AS user_name FROM order a;`</span><br><span class="line"></span><br><span class="line">   - **æ ¸å¿ƒå½±å“**ï¼šè‹¥å¤–å±‚è¡¨æœ‰ 100 ä¸‡è¡Œï¼Œå­æŸ¥è¯¢ä¼šæ‰§è¡Œ 100 ä¸‡æ¬¡ï¼Œæ€§èƒ½æä½ï¼Œç›¸å½“äº â€œå¾ªç¯åµŒå¥—æŸ¥è¯¢â€ã€‚</span><br><span class="line"></span><br><span class="line">   - **ç”¨ JOIN æ›¿ä»£ç›¸å…³å­æŸ¥è¯¢**ï¼Œå°†å¤šæ¬¡æŸ¥è¯¢è½¬ä¸ºä¸€æ¬¡å…³è”æŸ¥è¯¢ï¼š</span><br><span class="line"></span><br><span class="line">   - ```sql</span><br><span class="line">     select a.user_id, b.name as user_name </span><br><span class="line">     from order a </span><br><span class="line">     left join user b on a.user_id = b.id;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="SQLä¼˜åŒ–çš„æŠ€å·§"><a href="#SQLä¼˜åŒ–çš„æŠ€å·§" class="headerlink" title="SQLä¼˜åŒ–çš„æŠ€å·§"></a>SQLä¼˜åŒ–çš„æŠ€å·§</h3><h4 id="åˆ†åŒºé™åˆ¶"><a href="#åˆ†åŒºé™åˆ¶" class="headerlink" title="åˆ†åŒºé™åˆ¶"></a>åˆ†åŒºé™åˆ¶</h4><p>å¢é‡åˆ†åŒºè¡¨æ·»åŠ åˆ†åŒºé™åˆ¶ï¼Œå‡å°‘æ‰«æçš„æ•°æ®é‡</p>
<h4 id="å…ˆè¿‡æ»¤å†å…³è”"><a href="#å…ˆè¿‡æ»¤å†å…³è”" class="headerlink" title="å…ˆè¿‡æ»¤å†å…³è”"></a>å…ˆè¿‡æ»¤å†å…³è”</h4><p>æ ¸å¿ƒä¼˜åŒ–é€»è¾‘ï¼šå‡å°‘å‚ä¸å…³è”çš„æ•°æ®é›†å¤§å°ï¼Œé¿å…å¤§è¡¨ç›´æ¥å…³è”å¯¼è‡´çš„æ€§èƒ½æŸè€—ã€‚</p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<p>å…ˆå…³è”ä¸¤å¼ å¤§è¡¨ï¼Œå…³è”åæ‰ç”¨whereç­›é€‰æ¡ä»¶ï¼Œå¯¼è‡´å…³è”çš„æ•°æ®é‡æå¤§</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dt, <span class="built_in">count</span>(<span class="keyword">distinct</span> usr_id) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="comment">-- å…ˆå…³è”ä¸¤å¼ å¤§è¡¨</span></span><br><span class="line">  <span class="keyword">select</span> a.dt, a.usr_id, a.apl_chnl_cd, a.apl_dt, b.apl_cust_typ</span><br><span class="line">  <span class="keyword">from</span> edw.cdm.dwd_cas_apl_aprv_di a</span><br><span class="line">  <span class="keyword">join</span> edw.cdm.dwd_cas_apl_aprv_tag_di b <span class="keyword">on</span> a.apl_nbr <span class="operator">=</span> b.apl_nbr</span><br><span class="line">) c</span><br><span class="line"><span class="comment">-- å…³è”åæ‰ç­›é€‰æ¡ä»¶ï¼Œå¯¼è‡´å…³è”çš„æ•°æ®é‡æå¤§</span></span><br><span class="line"><span class="keyword">where</span> dt <span class="operator">=</span> <span class="string">&#x27;2020-11-01&#x27;</span></span><br><span class="line"><span class="keyword">and</span> apl_chnl_cd <span class="operator">=</span> <span class="string">&#x27;0APP&#x27;</span></span><br><span class="line"><span class="keyword">and</span> apl_cust_typ <span class="operator">=</span> <span class="string">&#x27;CRT_CUST_FIRST&#x27;</span></span><br><span class="line"><span class="keyword">and</span> apl_dt <span class="operator">&gt;</span> <span class="string">&#x27;1900-01-01&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dt;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ¡ˆ1ï¼šå…³è”æ—¶ç›´æ¥æ·»åŠ è¿‡æ»¤æ¡ä»¶</p>
<p>åœ¨onæ—¶å°±ç­›é€‰</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> a.dt, <span class="built_in">count</span>(<span class="keyword">distinct</span> a.usr_id) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_di a</span><br><span class="line"><span class="keyword">join</span> edw_cdm.dwd_cas_apl_aprv_tag_di b</span><br><span class="line"><span class="keyword">on</span> a.apl_nbr <span class="operator">=</span> b.apl_nbr</span><br><span class="line"><span class="keyword">and</span> b.apl_cust_typ <span class="operator">=</span> <span class="string">&#x27;CRT_CUST_FIRST&#x27;</span><span class="comment">-- å³è¡¨è¿‡æ»¤æ¡ä»¶æå‰åˆ° on å­å¥</span></span><br><span class="line"><span class="comment">-- å·¦è¡¨è¿‡æ»¤æ¡ä»¶æ”¾åœ¨ where ä¸­ï¼ˆæˆ– on ä¸­ï¼Œè§†å…³è”ç±»å‹è€Œå®šï¼‰</span></span><br><span class="line"><span class="keyword">where</span> a.dt <span class="operator">=</span> <span class="string">&#x27;2020-11-01&#x27;</span></span><br><span class="line"><span class="keyword">and</span> a.apl_chnl_cd <span class="operator">=</span> <span class="string">&#x27;0APP&#x27;</span></span><br><span class="line"><span class="keyword">and</span> a.apl_dt <span class="operator">&gt;</span> <span class="string">&#x27;1900-01-01&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.dt;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ¡ˆ2ï¼šå­æŸ¥è¯¢å…ˆè¿‡æ»¤å•è¡¨ï¼Œå†å…³è”ï¼ˆæ•ˆç‡æ›´ä¼˜ï¼‰</p>
<p>å…ˆåˆ†åˆ«whereç­›é€‰éœ€è¦çš„æ•°æ®ï¼Œå†joinå…³è”è¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> a.dt, <span class="built_in">count</span>(<span class="keyword">distinct</span> a.usr_id) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">  <span class="comment">-- å­æŸ¥è¯¢ 1ï¼šå…ˆè¿‡æ»¤å·¦è¡¨ aï¼Œåªä¿ç•™éœ€è¦çš„è¡Œ</span></span><br><span class="line">  <span class="keyword">select</span> dt, usr_id, apl_nbr</span><br><span class="line">  <span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_di</span><br><span class="line">  <span class="keyword">where</span> dt <span class="operator">=</span> <span class="string">&#x27;2020-11-01&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> apl_chnl_cd <span class="operator">=</span> <span class="string">&#x27;0APP&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> apl_dt <span class="operator">&gt;</span> <span class="string">&#x27;1900-01-01&#x27;</span></span><br><span class="line">) a</span><br><span class="line"><span class="keyword">join</span> (</span><br><span class="line">  <span class="comment">-- å­æŸ¥è¯¢ 2ï¼šå…ˆè¿‡æ»¤å³è¡¨ bï¼Œåªä¿ç•™éœ€è¦çš„è¡Œ</span></span><br><span class="line">  <span class="keyword">select</span> apl_nbr</span><br><span class="line">  <span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_tag_di</span><br><span class="line">  <span class="keyword">where</span> apl_cust_typ <span class="operator">=</span> <span class="string">&#x27;CRT_CUST_FIRST&#x27;</span></span><br><span class="line">) b <span class="keyword">on</span> a.apl_nbr <span class="operator">=</span> b.apl_nbr <span class="comment">-- å°æ•°æ®é›†å…³è”ï¼Œæ•ˆç‡é«˜</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.dt;</span><br></pre></td></tr></table></figure>

<h4 id="å…ˆè¿‡æ»¤å†ä½¿ç”¨å¤æ‚å‡½æ•°"><a href="#å…ˆè¿‡æ»¤å†ä½¿ç”¨å¤æ‚å‡½æ•°" class="headerlink" title="å…ˆè¿‡æ»¤å†ä½¿ç”¨å¤æ‚å‡½æ•°"></a>å…ˆè¿‡æ»¤å†ä½¿ç”¨å¤æ‚å‡½æ•°</h4><p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> usr_id, pvc</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">    user_no <span class="keyword">as</span> usr_id</span><br><span class="line">    ,get_json_object(cust_info, <span class="string">&#x27;$.merchantAddress&#x27;</span>) <span class="keyword">as</span> pvc  <span class="comment">-- å¤æ‚ JSON è§£æå‡½æ•°</span></span><br><span class="line">    ,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> user_no <span class="keyword">order</span> <span class="keyword">by</span> create_datetime <span class="keyword">desc</span>) <span class="keyword">as</span> rn  <span class="comment">-- çª—å£å‡½æ•°</span></span><br><span class="line">    <span class="keyword">from</span> edw_ods.cas_trx_cst_ext_provide_info</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">where</span> rn <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  usr_id,</span><br><span class="line">  get_json_object(cust_info, <span class="string">&#x27;$.merchantAddress&#x27;</span>) <span class="keyword">as</span> pvc <span class="comment">-- ä»…å¯¹è¿‡æ»¤åçš„æ•°æ®æ‰§è¡Œ JSON è§£æ</span></span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">  <span class="keyword">select</span></span><br><span class="line">    user_no <span class="keyword">as</span> usr_id</span><br><span class="line">    ,cust_info <span class="comment">-- ä»…ä¿ç•™åŸå§‹å­—æ®µï¼Œä¸æå‰è§£æ JSON</span></span><br><span class="line">    ,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> user_no <span class="keyword">order</span> <span class="keyword">by</span> create_datetime <span class="keyword">desc</span>) <span class="keyword">as</span> rn</span><br><span class="line">  <span class="keyword">from</span> edw_ods.cas_trx_cst_ext_provide_info</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">where</span> rn<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="æå‰è¿‡æ»¤null"><a href="#æå‰è¿‡æ»¤null" class="headerlink" title="æå‰è¿‡æ»¤null"></a>æå‰è¿‡æ»¤null</h4><ul>
<li>JOINå€¾æ–œ-å¤§è¡¨å…³è”å¤§è¡¨</li>
</ul>
<p>ä¸¤ä¸ªå¤§è¡¨å…³è”ï¼Œå¦‚æœå…³è”å­—æ®µåŒ…å«å¤§é‡æ— æ•ˆå€¼ï¼ˆNULLã€ç©ºå€¼ç­‰ï¼‰æˆ–æœ‰å¤§é‡é‡å¤æ•°æ®ï¼Œå…³è”ä¹‹åä¼šå¯¼è‡´æ•°æ®å€¾æ–œï¼Œæ•°æ®å€¾æ–œçš„ç‰¹å¾æ˜¯è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­é•¿æ—¶é—´å¡åœ¨99%ã€‚</p>
<ul>
<li>å€¾æ–œå€¼ä¸ºæ— æ•ˆå€¼ï¼ˆNULLï¼Œç©ºä¸²ç­‰ï¼‰ï¼Œå¦‚æœæ— æ•ˆå€¼ä¸éœ€è¦ï¼Œåˆ™ç›´æ¥è¿‡æ»¤ã€‚</li>
</ul>
<p>ä¼˜åŒ–å‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ç”³è¯·åŸºè¡¨å’Œç”³è¯·æ ‡ç­¾è¡¨åˆ†åˆ«æœ‰å‡ åƒä¸‡ç¬”æ¡ˆä»¶çš„å®¢æˆ·å·ä¸ºç©º</span></span><br><span class="line"><span class="keyword">select</span> xxx <span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_di a <span class="keyword">join</span> edw_cdm.dwd_cas_apl_aprv_tag_di b <span class="keyword">on</span> a.cust_id<span class="operator">=</span>b.cust_id;</span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ–åï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è¿‡æ»¤æ— æ•ˆå€¼</span></span><br><span class="line"><span class="keyword">select</span> xxx </span><br><span class="line"><span class="keyword">from</span>(<span class="keyword">select</span> apl_nbr,cust_id <span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_di <span class="keyword">where</span> cust_id<span class="operator">&lt;&gt;</span><span class="string">&#x27;&#x27;</span>) a</span><br><span class="line"><span class="keyword">join</span>(<span class="keyword">select</span> apl_nbr,cust_id <span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_tag_di <span class="keyword">where</span> cust_id<span class="operator">&lt;&gt;</span><span class="string">&#x27;&#x27;</span>) b <span class="keyword">on</span> a.cust_id<span class="operator">=</span>b.cust_id;</span><br></pre></td></tr></table></figure>

<ul>
<li>å€¾æ–œå€¼ä¸ºæ— æ•ˆå€¼ï¼ˆNULLï¼Œç©ºä¸²ç­‰ï¼‰ï¼Œå¦‚æœæ— æ•ˆå€¼éœ€è¦ä¿ç•™ï¼Œåˆ™å…ˆå¯¹æ— æ•ˆå€¼è¿›è¡Œéšæœºå¤„ç†ã€‚</li>
</ul>
<h4 id="ç”¨group-byå»é‡"><a href="#ç”¨group-byå»é‡" class="headerlink" title="ç”¨group byå»é‡"></a>ç”¨<code>group by</code>å»é‡</h4><ul>
<li>Reduceå€¾æ–œ-<code>distinct</code></li>
<li>ç”¨<code>group by</code>æ›¿ä»£<code>distinct</code>å»é‡</li>
</ul>
<p><code>distinct</code>ä¼šå¯¼è‡´æœ€ååªæœ‰ä¸€ä¸ªreducerï¼Œè€Œ<code>group by</code>ä¼šåˆ†å‘åˆ°ä¸åŒçš„reducerä¸Šã€‚è€ƒè™‘ç”¨<code>group by</code>ä»£æ›¿ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä¼˜åŒ–å‰  ç”¨æ—¶276s</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> cust_id) <span class="keyword">as</span> num </span><br><span class="line"><span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_di <span class="keyword">where</span> rsl_flg<span class="operator">=</span><span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line"><span class="comment">-- ä¼˜åŒ–å ç”¨æ—¶93s</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> cust_id <span class="keyword">from</span> edw_cdm.dwd_cas_apl_aprv_di <span class="keyword">where</span> rsl_flg<span class="operator">=</span><span class="string">&#x27;Y&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> cust_id) t1;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="åˆ·7å¤§ç±»å‹SQLé¢˜"><a href="#åˆ·7å¤§ç±»å‹SQLé¢˜" class="headerlink" title="åˆ·7å¤§ç±»å‹SQLé¢˜"></a>åˆ·7å¤§ç±»å‹SQLé¢˜</h1><blockquote>
<p>é¢˜å‹åŸºæœ¬è¦†ç›–é¢è¯•90%çš„é—®é¢˜ï¼</p>
</blockquote>
<ul>
<li>æ’åºç±»é—®é¢˜ï¼ˆæ™®é€šæ’åºï¼Œç»„å†…æ’åºï¼‰</li>
<li>TOPN é—®é¢˜</li>
<li>ç”¨æˆ·ç•™å­˜ã€å¤è´­ç‡ã€å®Œæ’­ç‡ç­‰è®¡ç®—å¤åˆæŒ‡æ ‡é—®é¢˜</li>
<li>æ–°ç”¨æˆ·æ•°ã€ç”¨æˆ·é—´éš”è¿ç»­ç™»å½•å¤©æ•°ã€æœ€é•¿è¿ç»­ç™»é™†é—®é¢˜</li>
<li>åç§»ç±»æ±‚å’Œæ±‚å¹³å‡é—®é¢˜ï¼ˆlag, leadå‡½æ•°ï¼‰</li>
<li>è¡Œåˆ—äº’è½¬é—®é¢˜</li>
<li>ä¸­ä½æ•°é—®é¢˜<ul>
<li>æ¯ä¸ªé—®é¢˜çš„ç›¸å…³çš„å‡½æ•°å’Œè¯­æ³•æœ‰å“ªäº›ï¼Œæœ‰æ²¡æœ‰å“ªäº›é—®é¢˜è¿™7ç±»æ²¡æ€»ç»“çš„</li>
<li>å¯¹ 7 å¤§ç±»å‹ SQL é¢è¯•é¢˜ï¼Œç»“åˆ PostgreSQL è¯­æ³•ç»™å‡ºå…¸å‹ä¾‹é¢˜åŠç­”æ¡ˆ</li>
<li>å¯¹ 7 å¤§ç±»å‹ SQL é¢è¯•é¢˜ï¼Œç»“åˆ PostgreSQL å’Œtrinoè¯­æ³•åˆ†åˆ«ç»™å‡ºå…¸å‹ä¾‹é¢˜åŠç­”æ¡ˆï¼Œç”¨æœ€å°‘çš„è¡¨å’Œå­—æ®µå®Œæˆæ‰€æœ‰ç¤ºä¾‹ï¼Œå…³é”®å­—ç”¨å°å†™ï¼Œç¤ºä¾‹è¦è§£é‡Šè¯­æ³•çš„ä½¿ç”¨å’Œç”¨åˆ°çš„å‡½æ•°</li>
<li>PostgreSQL å’Œtrinoè¯­æ³•åˆ†åˆ«ç»™å‡ºç­”æ¡ˆï¼Œå…³é”®å­—ç”¨å°å†™</li>
</ul>
</li>
</ul>
<h2 id="æ’åºç±»é—®é¢˜ï¼ˆæ™®é€šæ’åºï¼Œç»„å†…æ’åºï¼‰"><a href="#æ’åºç±»é—®é¢˜ï¼ˆæ™®é€šæ’åºï¼Œç»„å†…æ’åºï¼‰" class="headerlink" title="æ’åºç±»é—®é¢˜ï¼ˆæ™®é€šæ’åºï¼Œç»„å†…æ’åºï¼‰"></a>æ’åºç±»é—®é¢˜ï¼ˆæ™®é€šæ’åºï¼Œç»„å†…æ’åºï¼‰</h2><p><strong>æ™®é€šæ’åº</strong>ï¼šä½¿ç”¨<code>order by</code>å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºã€‚<br><strong>ç»„å†…æ’åº</strong>ï¼šä½¿ç”¨çª—å£å‡½æ•°<code>row_number()</code>, <code>rank()</code>, <code>dense_rank()</code>ç­‰ï¼Œåœ¨åˆ†ç»„å†…è¿›è¡Œæ’åºã€‚<br>é…åˆ <code>PARTITION BY</code>è¿›è¡Œåˆ†ç»„ï¼Œ<code>ORDER BY</code>åœ¨ç»„å†…æ’åº</p>
<ul>
<li>æ’åºå‡½æ•°ï¼šrow_number(), rank(), dense_rank(), tnile()</li>
<li>ASC&#x2F;DESC</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> dt)  <span class="comment">-- è¿ç»­ä¸é‡å¤æ’å   </span></span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> sales)       <span class="comment">-- å¹¶åˆ—æ’åä¼šè·³è¿‡åç»­åæ¬¡</span></span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> sales) <span class="comment">-- å¹¶åˆ—æ’åä¸è·³åæ¬¡</span></span><br><span class="line"><span class="built_in">ntile</span>(n) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sales)                       <span class="comment">-- åˆ†ç»„æ’å</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ROW_NUMBER()</code>: è¿ç»­å”¯ä¸€åºå·ï¼ˆ1,2,3,4ï¼‰</li>
<li><code>RANK()</code>: å¹¶åˆ—æ—¶æ’åç›¸åŒï¼Œåç»­åºå·è·³è¿‡ï¼ˆ1,2,2,4ï¼‰</li>
<li><code>DENSE_RANK()</code>: å¹¶åˆ—æ—¶æ’åç›¸åŒï¼Œåºå·è¿ç»­ï¼ˆ1,2,2,3ï¼‰</li>
<li><code>NTILE()</code>: åˆ†æ¡¶ï¼Œå¸¸ç”¨äºäº”åˆ†ä½ã€ååˆ†ä½ç­‰</li>
</ul>
<p><strong>ä¾‹é¢˜</strong>ï¼šæœ‰è¡¨1ï¼ˆ<code>region</code>åœ°åŒºï¼Œ<code>dt</code>æ—¥æœŸï¼Œ<code>sales</code>é”€å”®é¢ï¼‰ï¼ŒæŒ‰åœ°åŒºåˆ†ç»„ï¼Œç»™æ¯å¤©çš„é”€å”®é¢æŒ‰é™åºæ’ç»„å†…åæ¬¡ï¼ˆå…è®¸å¹¶åˆ—ï¼Œä¸è·³å·ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> region</span><br></pre></td></tr></table></figure>



<h2 id="TOPN-é—®é¢˜"><a href="#TOPN-é—®é¢˜" class="headerlink" title="TOPN é—®é¢˜"></a>TOPN é—®é¢˜</h2><p>ä½¿ç”¨çª—å£å‡½æ•°æˆ–å­æŸ¥è¯¢æ¥è·å–æ¯ä¸ªç»„å†…å‰Næ¡è®°å½•ã€‚</p>
<ul>
<li>ä½¿ç”¨<code>row_number()</code>é…åˆwhereæ¡ä»¶</li>
<li>æˆ–è€…ä½¿ç”¨<code>limit()</code>ï¼ˆåœ¨MySQL&#x2F;PostgreSQLï¼‰æˆ–TOPï¼ˆåœ¨SQL Serverï¼‰ç­‰</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨çª—å£å‡½æ•°</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">	,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">DESC</span>) <span class="keyword">as</span> rn</span><br><span class="line">	<span class="keyword">from</span> table1</span><br><span class="line">	)t</span><br><span class="line"><span class="keyword">where</span> rn<span class="operator">&lt;=</span><span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨LIMITï¼ˆç®€å•åœºæ™¯ï¼‰</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table1</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">DESC</span></span><br><span class="line">limit <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>å…¨å±€TOPN<br>è¯­æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> æ’åºåˆ— <span class="keyword">DESC</span>) <span class="keyword">as</span> rn</span><br><span class="line">    <span class="keyword">from</span> è¡¨å</span><br><span class="line">)t</span><br><span class="line"><span class="keyword">where</span> rn<span class="operator">&lt;=</span>N</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šå–é”€å”®é¢å‰3çš„è®¢å•</p>
</li>
<li><p>åˆ†ç»„TOPN<br>è¯­æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> åˆ†ç»„åˆ— <span class="keyword">order</span> <span class="keyword">by</span> æ’åºåˆ— <span class="keyword">DESC</span>) <span class="keyword">as</span> rn</span><br><span class="line">    <span class="keyword">from</span> è¡¨å</span><br><span class="line">)t</span><br><span class="line"><span class="keyword">where</span> rn<span class="operator">&lt;=</span>N</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šå–æ¯ä¸ªåœ°åŒºé”€å”®é¢å‰2çš„è®¢å•</p>
</li>
</ol>
<h2 id="ç”¨æˆ·ç•™å­˜ã€å¤è´­ç‡ã€å®Œæ’­ç‡ç­‰è®¡ç®—å¤åˆæŒ‡æ ‡é—®é¢˜"><a href="#ç”¨æˆ·ç•™å­˜ã€å¤è´­ç‡ã€å®Œæ’­ç‡ç­‰è®¡ç®—å¤åˆæŒ‡æ ‡é—®é¢˜" class="headerlink" title="ç”¨æˆ·ç•™å­˜ã€å¤è´­ç‡ã€å®Œæ’­ç‡ç­‰è®¡ç®—å¤åˆæŒ‡æ ‡é—®é¢˜"></a>ç”¨æˆ·ç•™å­˜ã€å¤è´­ç‡ã€å®Œæ’­ç‡ç­‰è®¡ç®—å¤åˆæŒ‡æ ‡é—®é¢˜</h2><p>è¿™ç±»é—®é¢˜é€šå¸¸éœ€è¦è®¡ç®—æ¯”ç‡ï¼Œä¾‹å¦‚ç”¨æˆ·ç•™å­˜ç‡æ˜¯è®¡ç®—æŸå¤©æ–°å¢çš„ç”¨æˆ·åœ¨åç»­æŸå¤©ä»ç„¶æ´»è·ƒçš„æ¯”ä¾‹ã€‚</p>
<ul>
<li>å¸¸ç”¨æ—¥æœŸå‡½æ•°ï¼š<code>date_diff()</code>, <code>date_add()</code> ç­‰</li>
<li>èšåˆå‡½æ•°ï¼š<code>sum(case when ...)</code>, <code>count(distinct ...)</code></li>
<li>æ¡ä»¶è¡¨è¾¾å¼ï¼šcase when, if</li>
<li>å°æ•°ä¿ç•™nä½æ•°ï¼š<code>round(expr, n)</code></li>
<li>æ•°æ®ç±»å‹è½¬æ¢ï¼š<code>cast(expr as decimal)</code></li>
</ul>
<p>PostgreSQL</p>
<ul>
<li><code>expr + INTERVAL &#39;1 day&#39;</code></li>
</ul>
<p>Trino</p>
<ul>
<li><code>date_add(&#39;day&#39;, 1, expr)</code></li>
</ul>
<h2 id="æ–°ç”¨æˆ·æ•°ã€ç”¨æˆ·é—´éš”è¿ç»­ç™»å½•å¤©æ•°ã€æœ€é•¿è¿ç»­ç™»é™†é—®é¢˜"><a href="#æ–°ç”¨æˆ·æ•°ã€ç”¨æˆ·é—´éš”è¿ç»­ç™»å½•å¤©æ•°ã€æœ€é•¿è¿ç»­ç™»é™†é—®é¢˜" class="headerlink" title="æ–°ç”¨æˆ·æ•°ã€ç”¨æˆ·é—´éš”è¿ç»­ç™»å½•å¤©æ•°ã€æœ€é•¿è¿ç»­ç™»é™†é—®é¢˜"></a>æ–°ç”¨æˆ·æ•°ã€ç”¨æˆ·é—´éš”è¿ç»­ç™»å½•å¤©æ•°ã€æœ€é•¿è¿ç»­ç™»é™†é—®é¢˜</h2><ul>
<li>å¸¸ç”¨çª—å£å‡½æ•°ï¼š<code>lag()</code>ã€<code>lead()</code>ï¼Œç”¨äºè·å–å‰åè¡Œçš„æ•°æ®</li>
<li>æ—¥æœŸå‡½æ•°ï¼š<code>date_diff()</code>ã€<code>timestamp_diff()</code>ï¼Œè®¡ç®—æ—¶é—´é—´éš”</li>
<li>ä½¿ç”¨å˜é‡æˆ–çª—å£å‡½æ•°æ¥åˆ†ç»„è¿ç»­ç™»å½•</li>
</ul>
<p>PostgreSQL</p>
<ul>
<li><code>expr +/- INTERVAL &#39;1 day&#39;</code></li>
</ul>
<p>Trino</p>
<ul>
<li><code>date_add(&#39;day&#39;, 1, expr)</code></li>
</ul>
<h3 id="æŠ–éŸ³ç”µå•†æ•°æ®åˆ†æç¬”è¯•SQLé¢˜"><a href="#æŠ–éŸ³ç”µå•†æ•°æ®åˆ†æç¬”è¯•SQLé¢˜" class="headerlink" title="æŠ–éŸ³ç”µå•†æ•°æ®åˆ†æç¬”è¯•SQLé¢˜"></a>æŠ–éŸ³ç”µå•†æ•°æ®åˆ†æç¬”è¯•SQLé¢˜</h3><p>1ã€æœ‰ä¸€å¼ è®¢å•è¡¨(order_info)ï¼Œè¡¨ç»“æ„å¦‚ä¸‹:order_idã€goods_idã€order_timeã€order_gmv<br>é—®é¢˜ï¼šè¯·ç»Ÿè®¡2024å¹´9æœˆ10æ—¥è¿™å¤©é”€é‡é‡‘é¢å‰10çš„å•†å“ä¿¡æ¯ã€‚<br>è¦æ±‚:æ’åç›¸åŒçš„ä¸€èµ·ä½œä¸ºåŒæ’åæ¬¡åºè¾“å‡º<br>2ã€æœ‰ä¸€å¼ ç”¨æˆ·ç™»å½•è¡¨(user_login_log)ï¼Œè¡¨ç»“æ„å¦‚ä¸‹:uidã€login_time<br>é—®é¢˜ï¼šè¯·ç»Ÿè®¡2024.9.1ä¹‹å‰æ´»è·ƒè¿‡ï¼Œä½†æ˜¯9.1ä¹‹åå†ä¹Ÿæ²¡æœ‰æ´»è·ƒè¿‡çš„ç”¨æˆ·</p>
<ul>
<li><p>åˆ›å»ºè¡¨å¹¶å¸®æˆ‘å¡«å…¥ä¸€äº›æ•°æ®</p>
</li>
<li><p>è§£æ³•æ˜¯æœ€é«˜æ•ˆç‡çš„å—ï¼Œbpçº§æ•°æ®å¯ç”¨ä¸</p>
</li>
</ul>
<ol>
<li><p>å•†å“é”€é‡æ’åå‰10ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 2å±‚å­æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	good_id</span><br><span class="line">	,order_gmv</span><br><span class="line">	,rank</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">    	good_id</span><br><span class="line">	    ,order_gmv</span><br><span class="line">    	,<span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> total_gmv <span class="keyword">desc</span>) <span class="keyword">as</span> rank</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">    	<span class="keyword">select</span></span><br><span class="line">        	good_id</span><br><span class="line">        	,<span class="built_in">sum</span>(order_gmv) <span class="keyword">as</span> total_gmv</span><br><span class="line">        <span class="keyword">from</span> order_info</span><br><span class="line">        <span class="keyword">where</span> <span class="built_in">cast</span>(order_time <span class="keyword">as</span> <span class="type">date</span>) <span class="operator">=</span> <span class="string">&#x27;2024-09-10&#x27;</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> good_id</span><br><span class="line">    ) <span class="keyword">as</span> res</span><br><span class="line">) <span class="keyword">as</span> res</span><br><span class="line"><span class="keyword">where</span> rank <span class="operator">&lt;=</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1å±‚å­æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    rank_num, goods_id, total_gmv</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="built_in">dense_rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">sum</span>(total_gmv) <span class="keyword">desc</span>) <span class="keyword">as</span> rank</span><br><span class="line">        ,goods_id</span><br><span class="line">        ,<span class="built_in">sum</span>(order_gmv) <span class="keyword">as</span> total_gmv</span><br><span class="line">    <span class="keyword">from</span> order_info</span><br><span class="line">    <span class="keyword">where</span> <span class="built_in">cast</span>(order_time <span class="keyword">as</span> <span class="type">date</span>) <span class="operator">=</span> <span class="string">&#x27;2024-09-10&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> goods_id</span><br><span class="line">) t</span><br><span class="line"><span class="keyword">where</span> rank <span class="operator">&lt;=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>


</li>
<li><p>ç”¨æˆ·æµå¤±åˆ†æï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä¸å†™CTE</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	t.uid</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">    	uid</span><br><span class="line">    <span class="keyword">from</span> user_login_log</span><br><span class="line">    <span class="keyword">where</span> login_time <span class="operator">&lt;=</span> <span class="string">&#x27;2024-09-01&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> uid</span><br><span class="line">) <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>(</span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">    	uid</span><br><span class="line">    <span class="keyword">from</span> user_login_log</span><br><span class="line">    <span class="keyword">where</span> login_time <span class="operator">&gt;</span> <span class="string">&#x27;2024-09-01&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> uid</span><br><span class="line">)<span class="keyword">as</span> t1 </span><br><span class="line"><span class="keyword">on</span> t.uid<span class="operator">=</span>t1.uid</span><br><span class="line"><span class="keyword">where</span> t1.uid <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å†™CTE</span></span><br><span class="line"><span class="keyword">with</span> tmp_before <span class="keyword">as</span>(</span><br><span class="line">	<span class="keyword">select</span> uid</span><br><span class="line">    <span class="keyword">from</span> user_login_log</span><br><span class="line">    <span class="keyword">where</span> login_time <span class="operator">&lt;=</span> <span class="string">&#x27;2024-09-01&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">)</span><br><span class="line">, tmp_after <span class="keyword">as</span>(</span><br><span class="line">	<span class="keyword">select</span> uid</span><br><span class="line">    <span class="keyword">from</span> user_login_log</span><br><span class="line">    <span class="keyword">where</span> login_time <span class="operator">&gt;</span> <span class="string">&#x27;2024-09-01&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> t.uid</span><br><span class="line"><span class="keyword">from</span> tmp_before t</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> tmp_after t1 <span class="keyword">on</span> t.uid<span class="operator">=</span>t1.uid</span><br><span class="line"><span class="keyword">where</span> t1.uid <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>å»ºè¡¨æµ‹è¯•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* PostgreSQLè¯­æ³• */</span></span><br><span class="line"><span class="comment">-- åˆ›å»ºè®¢å•è¡¨</span></span><br><span class="line"><span class="keyword">create table</span> order_info (</span><br><span class="line">    order_id <span class="type">int</span> <span class="keyword">primary key</span>,</span><br><span class="line">    goods_id <span class="type">int</span>,</span><br><span class="line">    order_time <span class="type">timestamp</span>,</span><br><span class="line">    order_gmv <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ’å…¥æµ‹è¯•æ•°æ®ï¼ˆ2024å¹´9æœˆ10æ—¥ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> order_info <span class="keyword">values</span></span><br><span class="line">(<span class="number">1001</span>, <span class="number">101</span>, <span class="string">&#x27;2024-09-10 08:30:00&#x27;</span>, <span class="number">299.99</span>),</span><br><span class="line">(<span class="number">1002</span>, <span class="number">102</span>, <span class="string">&#x27;2024-09-10 09:15:00&#x27;</span>, <span class="number">1500.00</span>),</span><br><span class="line">(<span class="number">1003</span>, <span class="number">103</span>, <span class="string">&#x27;2024-09-10 10:20:00&#x27;</span>, <span class="number">899.50</span>),</span><br><span class="line">(<span class="number">1004</span>, <span class="number">101</span>, <span class="string">&#x27;2024-09-10 10:45:00&#x27;</span>, <span class="number">299.99</span>),</span><br><span class="line">(<span class="number">1005</span>, <span class="number">102</span>, <span class="string">&#x27;2024-09-10 11:00:00&#x27;</span>, <span class="number">1500.00</span>),</span><br><span class="line">(<span class="number">1006</span>, <span class="number">104</span>, <span class="string">&#x27;2024-09-10 11:30:00&#x27;</span>, <span class="number">599.99</span>),</span><br><span class="line">(<span class="number">1007</span>, <span class="number">105</span>, <span class="string">&#x27;2024-09-10 12:00:00&#x27;</span>, <span class="number">2299.00</span>),</span><br><span class="line">(<span class="number">1008</span>, <span class="number">101</span>, <span class="string">&#x27;2024-09-10 12:45:00&#x27;</span>, <span class="number">299.99</span>),</span><br><span class="line">(<span class="number">1009</span>, <span class="number">106</span>, <span class="string">&#x27;2024-09-10 13:20:00&#x27;</span>, <span class="number">450.00</span>),</span><br><span class="line">(<span class="number">1010</span>, <span class="number">102</span>, <span class="string">&#x27;2024-09-10 14:00:00&#x27;</span>, <span class="number">1500.00</span>),</span><br><span class="line">(<span class="number">1011</span>, <span class="number">107</span>, <span class="string">&#x27;2024-09-10 14:30:00&#x27;</span>, <span class="number">3499.99</span>),</span><br><span class="line">(<span class="number">1012</span>, <span class="number">103</span>, <span class="string">&#x27;2024-09-10 15:00:00&#x27;</span>, <span class="number">899.50</span>),</span><br><span class="line">(<span class="number">1013</span>, <span class="number">108</span>, <span class="string">&#x27;2024-09-10 15:45:00&#x27;</span>, <span class="number">199.99</span>),</span><br><span class="line">(<span class="number">1014</span>, <span class="number">105</span>, <span class="string">&#x27;2024-09-10 16:20:00&#x27;</span>, <span class="number">2299.00</span>),</span><br><span class="line">(<span class="number">1015</span>, <span class="number">109</span>, <span class="string">&#x27;2024-09-10 17:00:00&#x27;</span>, <span class="number">799.99</span>),</span><br><span class="line">(<span class="number">1016</span>, <span class="number">101</span>, <span class="string">&#x27;2024-09-10 17:30:00&#x27;</span>, <span class="number">299.99</span>),</span><br><span class="line">(<span class="number">1017</span>, <span class="number">110</span>, <span class="string">&#x27;2024-09-10 18:00:00&#x27;</span>, <span class="number">1099.00</span>),</span><br><span class="line">(<span class="number">1018</span>, <span class="number">102</span>, <span class="string">&#x27;2024-09-10 18:45:00&#x27;</span>, <span class="number">1500.00</span>),</span><br><span class="line">(<span class="number">1019</span>, <span class="number">107</span>, <span class="string">&#x27;2024-09-10 19:20:00&#x27;</span>, <span class="number">3499.99</span>),</span><br><span class="line">(<span class="number">1020</span>, <span class="number">111</span>, <span class="string">&#x27;2024-09-10 20:00:00&#x27;</span>, <span class="number">599.50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> order_info;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* PostgreSQLè¯­æ³• */</span></span><br><span class="line"><span class="comment">-- åˆ›å»ºç”¨æˆ·ç™»å½•è¡¨</span></span><br><span class="line"><span class="keyword">create table</span> user_login_log (</span><br><span class="line">    uid <span class="type">int</span>,</span><br><span class="line">    login_time <span class="type">timestamp</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ’å…¥æµ‹è¯•æ•°æ®</span></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1001: 9æœˆ1æ—¥å‰æ´»è·ƒï¼Œä¹‹åæœªæ´»è·ƒï¼ˆæµå¤±ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1001</span>, <span class="string">&#x27;2024-08-25 10:30:00&#x27;</span>),</span><br><span class="line">(<span class="number">1001</span>, <span class="string">&#x27;2024-08-28 14:20:00&#x27;</span>),</span><br><span class="line">(<span class="number">1001</span>, <span class="string">&#x27;2024-08-31 18:45:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1002: 9æœˆ1æ—¥å‰æ´»è·ƒï¼Œä¹‹åä¹Ÿæ´»è·ƒï¼ˆä¿ç•™ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1002</span>, <span class="string">&#x27;2024-08-20 09:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1002</span>, <span class="string">&#x27;2024-08-30 15:30:00&#x27;</span>),</span><br><span class="line">(<span class="number">1002</span>, <span class="string">&#x27;2024-09-05 11:20:00&#x27;</span>),</span><br><span class="line">(<span class="number">1002</span>, <span class="string">&#x27;2024-09-15 16:45:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1003: 9æœˆ1æ—¥å‰æ´»è·ƒï¼Œä¹‹åæœªæ´»è·ƒï¼ˆæµå¤±ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1003</span>, <span class="string">&#x27;2024-08-15 10:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1003</span>, <span class="string">&#x27;2024-08-22 13:30:00&#x27;</span>),</span><br><span class="line">(<span class="number">1003</span>, <span class="string">&#x27;2024-08-29 20:15:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1004: ä»…åœ¨9æœˆ1æ—¥åæ´»è·ƒï¼ˆæ–°ç”¨æˆ·ï¼Œä¸ç¬¦åˆæ¡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1004</span>, <span class="string">&#x27;2024-09-10 12:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1004</span>, <span class="string">&#x27;2024-09-18 14:30:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1005: 9æœˆ1æ—¥å‰æ´»è·ƒï¼Œä¹‹åä¹Ÿæ´»è·ƒï¼ˆä¿ç•™ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1005</span>, <span class="string">&#x27;2024-08-10 08:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1005</span>, <span class="string">&#x27;2024-08-25 17:45:00&#x27;</span>),</span><br><span class="line">(<span class="number">1005</span>, <span class="string">&#x27;2024-09-08 09:20:00&#x27;</span>),</span><br><span class="line">(<span class="number">1005</span>, <span class="string">&#x27;2024-09-20 19:00:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1006: 9æœˆ1æ—¥å‰æ´»è·ƒï¼Œä¹‹åæœªæ´»è·ƒï¼ˆæµå¤±ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1006</span>, <span class="string">&#x27;2024-08-05 11:30:00&#x27;</span>),</span><br><span class="line">(<span class="number">1006</span>, <span class="string">&#x27;2024-08-31 15:20:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1007: 9æœˆ1æ—¥å‰æ´»è·ƒï¼Œä¹‹åæœªæ´»è·ƒï¼ˆæµå¤±ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1007</span>, <span class="string">&#x27;2024-08-12 10:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1007</span>, <span class="string">&#x27;2024-08-26 13:15:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨æˆ·1008: ä»…åœ¨9æœˆ1æ—¥åæ´»è·ƒï¼ˆæ–°ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="keyword">insert into</span> user_login_log <span class="keyword">values</span></span><br><span class="line">(<span class="number">1008</span>, <span class="string">&#x27;2024-09-22 11:00:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_login_log;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="åç§»ç±»æ±‚å’Œæ±‚å¹³å‡é—®é¢˜ï¼ˆlag-leadå‡½æ•°ï¼‰"><a href="#åç§»ç±»æ±‚å’Œæ±‚å¹³å‡é—®é¢˜ï¼ˆlag-leadå‡½æ•°ï¼‰" class="headerlink" title="åç§»ç±»æ±‚å’Œæ±‚å¹³å‡é—®é¢˜ï¼ˆlag, leadå‡½æ•°ï¼‰"></a>åç§»ç±»æ±‚å’Œæ±‚å¹³å‡é—®é¢˜ï¼ˆlag, leadå‡½æ•°ï¼‰</h2><ul>
<li>çª—å£å‡½æ•°ï¼š<code>lag()</code>ã€<code>lead()</code>, ç”¨äºè·å–å‰åè¡Œçš„å€¼</li>
<li>çª—å£å‡½æ•°ï¼š<code>sum()</code>ï¼Œ<code>avg()</code> ç­‰ç»“åˆrows&#x2F;range</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">lag</span>(sales,<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>) <span class="keyword">as</span> prev_sales</span><br><span class="line"><span class="built_in">lead</span>(sales,<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>) <span class="keyword">as</span> next_sales</span><br><span class="line"><span class="built_in">avg</span>(sales) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> region <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">6</span> preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) <span class="keyword">as</span> moving_avg</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>rows&#x2F;range</strong> çª—å£å¸§<ul>
<li>åŒ…æ‹¬å·¦å³åŒºé—´</li>
<li><code>unbounded preceding</code>                      åˆ†åŒºå¤´</li>
<li><code>unbounded following</code>                       åˆ†åŒºå°¾</li>
<li><code>interval &#39;1 month&#39; preceding</code>    å‰1ä¸ªæœˆ</li>
<li><code>n preceding </code>                 å‰nè¡Œ</li>
<li><code>current row</code>                   å½“å‰è¡Œ</li>
<li><code>n following</code>                   ånè¡Œ</li>
</ul>
</li>
</ul>
<ol>
<li><p>åˆ†åŒºå¤´åˆ°åˆ†åŒºå°¾ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> unbounded preceding <span class="keyword">and</span> unbounded following</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‰nè¡Œåˆ°å½“å‰è¡Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> n preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“å‰è¡Œåˆ°ånè¡Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> <span class="keyword">current</span> <span class="type">row</span> <span class="keyword">and</span> n following</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‰nè¡Œåˆ°ånè¡Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> n preceding <span class="keyword">and</span> n following</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ†åŒºå¤´åˆ°å½“å‰è¡Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> unbounded preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“å‰è¡Œåˆ°åˆ†åŒºå°¾</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rows</span> <span class="keyword">between</span> <span class="keyword">current</span> <span class="type">row</span> <span class="keyword">and</span> unbounded following</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‰ä¸€ä¸ªæœˆåˆ°å½“å‰è¡Œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">range</span> <span class="keyword">between</span> <span class="type">interval</span> <span class="string">&#x27;1 month&#x27;</span> preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»§ç»­ã€‚ã€‚ã€‚</p>
</li>
</ol>
<ul>
<li>åŒæ¯”ç¯æ¯”<ul>
<li><code>lag(expr,1)</code>ï¼Œ<code>lag(expr,12)</code></li>
</ul>
</li>
</ul>
<h2 id="è¡Œåˆ—äº’è½¬é—®é¢˜"><a href="#è¡Œåˆ—äº’è½¬é—®é¢˜" class="headerlink" title="è¡Œåˆ—äº’è½¬é—®é¢˜"></a>è¡Œåˆ—äº’è½¬é—®é¢˜</h2><ul>
<li>è¡Œè½¬åˆ—ï¼šä½¿ç”¨<code>case when</code>æˆ– <code>pivot</code>ï¼ˆéƒ¨åˆ†æ•°æ®åº“æ”¯æŒï¼Œå¦‚SQL Serverï¼‰</li>
<li>åˆ—è½¬è¡Œï¼šä½¿ç”¨<code>union all</code>æˆ– <code>unpivot</code>ï¼ˆéƒ¨åˆ†æ•°æ®åº“æ”¯æŒï¼‰</li>
</ul>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong></p>
<ul>
<li><p>è¡Œè½¬åˆ—ï¼š</p>
<p> å°†æŸä¸€åˆ—ä¸­çš„å”¯ä¸€å€¼è½¬æ¢ä¸ºæ–°çš„åˆ—åï¼Œå¹¶å°†å¦ä¸€åˆ—çš„å€¼å¡«å……åˆ°è¿™äº›æ–°åˆ—ä¹‹ä¸‹ã€‚é€šå¸¸ä¼´éšèšåˆæ“ä½œã€‚</p>
<ul>
<li><em>ç¤ºä¾‹ï¼š</em> å°† <code>(å¹´ä»½, å­£åº¦, é”€å”®é¢)</code> è½¬æ¢ä¸º <code>(å¹´ä»½, Q1é”€å”®é¢, Q2é”€å”®é¢, Q3é”€å”®é¢, Q4é”€å”®é¢)</code>ã€‚</li>
</ul>
</li>
<li><p>åˆ—è½¬è¡Œï¼š</p>
<p> æ˜¯è¡Œè½¬åˆ—çš„é€†æ“ä½œï¼Œå°†å¤šä¸ªåˆ—åˆå¹¶æˆä¸¤ä¸ªåˆ—ï¼šä¸€ä¸ªç”¨äºå­˜å‚¨åŸåˆ—åï¼ˆé”®ï¼‰ï¼Œä¸€ä¸ªç”¨äºå­˜å‚¨åŸåˆ—çš„å€¼ï¼ˆå€¼ï¼‰ã€‚</p>
<ul>
<li><em>ç¤ºä¾‹ï¼š</em> å°† <code>(å¹´ä»½, Q1é”€å”®é¢, Q2é”€å”®é¢, Q3é”€å”®é¢, Q4é”€å”®é¢)</code> è½¬æ¢å› <code>(å¹´ä»½, å­£åº¦, é”€å”®é¢)</code>ã€‚</li>
</ul>
</li>
</ul>
<p><img src="/./../%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/image-20251023164941369.png" alt="image-20251023164941369"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* é€šç”¨è¯­æ³•ï¼Ÿï¼Ÿï¼Ÿ */</span></span><br><span class="line"><span class="keyword">create table</span> t(id <span class="type">int</span>, seller text, product text, amount <span class="type">int</span>);</span><br><span class="line"><span class="keyword">insert into</span> t <span class="keyword">values</span></span><br><span class="line">(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;alice&#x27;</span>,<span class="string">&#x27;dior&#x27;</span>,<span class="number">310</span>),</span><br><span class="line">(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;alice&#x27;</span>,<span class="string">&#x27;lamer&#x27;</span>,<span class="number">285</span>),</span><br><span class="line">(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;alice&#x27;</span>,<span class="string">&#x27;sk2&#x27;</span>,<span class="number">265</span>),</span><br><span class="line">(<span class="string">&#x27;102&#x27;</span>, <span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;dior&#x27;</span>,<span class="number">305</span>),</span><br><span class="line">(<span class="string">&#x27;102&#x27;</span>, <span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;lamer&#x27;</span>,<span class="number">290</span>),</span><br><span class="line">(<span class="string">&#x27;102&#x27;</span>, <span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;sk2&#x27;</span>,<span class="number">280</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    id,seller</span><br><span class="line">    ,<span class="built_in">sum</span>(amount) <span class="keyword">filter</span> (<span class="keyword">where</span> product <span class="operator">=</span> <span class="string">&#x27;dior&#x27;</span>)  <span class="keyword">as</span> dior</span><br><span class="line">    ,<span class="built_in">sum</span>(amount) <span class="keyword">filter</span> (<span class="keyword">where</span> product <span class="operator">=</span> <span class="string">&#x27;lamer&#x27;</span>) <span class="keyword">as</span> lamer</span><br><span class="line">    ,<span class="built_in">sum</span>(amount) <span class="keyword">filter</span> (<span class="keyword">where</span> product <span class="operator">=</span> <span class="string">&#x27;sk2&#x27;</span>)   <span class="keyword">as</span> sk2</span><br><span class="line"><span class="keyword">from</span> t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span>;</span><br></pre></td></tr></table></figure>



<p>PostgreSQL</p>
<ul>
<li><code>case when</code></li>
<li><code>filter</code></li>
</ul>
<p>Trino</p>
<ul>
<li><code>case when</code></li>
<li><code>filter</code></li>
<li><code>count_if</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* PostgreSQLè¯­æ³• */</span></span><br><span class="line"><span class="keyword">select</span> dt</span><br><span class="line">,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> shop<span class="operator">=</span><span class="string">&#x27;Aåº—&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> shop1</span><br><span class="line">,<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> shop<span class="operator">=</span><span class="string">&#x27;Båº—&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> shop2</span><br><span class="line"><span class="keyword">from</span> t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Trinoè¯­æ³• */</span></span><br><span class="line"><span class="keyword">select</span> dt</span><br><span class="line">,count_if(shop<span class="operator">=</span><span class="string">&#x27;Aåº—&#x27;</span>) <span class="keyword">as</span> shop1</span><br><span class="line">,count_if(shop<span class="operator">=</span><span class="string">&#x27;Båº—&#x27;</span>) <span class="keyword">as</span> shop2</span><br><span class="line"><span class="keyword">from</span> t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<h2 id="ä¸­ä½æ•°é—®é¢˜"><a href="#ä¸­ä½æ•°é—®é¢˜" class="headerlink" title="ä¸­ä½æ•°é—®é¢˜"></a>ä¸­ä½æ•°é—®é¢˜</h2><ul>
<li>æ–¹æ³•1ï¼šä½¿ç”¨çª—å£å‡½æ•°ï¼šPERCENTILE_CONT, PERCENTILE_DISCç­‰ï¼ˆéƒ¨åˆ†æ•°æ®åº“æ”¯æŒï¼Œå¦‚PostgreSQLã€SQL Serverï¼‰</li>
<li>æ–¹æ³•2ï¼šä½¿ç”¨æ’åºå’Œè®¡æ•°çš„æ–¹æ³•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">percentile_cont</span>(<span class="number">0.5</span>) <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> score) <span class="keyword">as</span> median</span><br></pre></td></tr></table></figure>

<p>PostgreSQL</p>
<ul>
<li><code>percentile_cont()</code>è¿ç»­ç™¾åˆ†ä½æ•°ï¼ˆæ¨èï¼‰</li>
<li><code>percentile_disc()</code>ç¦»æ•£ç™¾åˆ†ä½æ•°</li>
<li><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong><ul>
<li>è‹¥æ•°æ®æ˜¯<strong>è¿ç»­å‹</strong>ï¼ˆå¦‚ä»·æ ¼ã€æ—¶é•¿ï¼‰ï¼Œä¸”å¸Œæœ›ç™¾åˆ†ä½ç»“æœæ›´ç²¾ç¡®ï¼ˆå…è®¸æ’å€¼ï¼‰ï¼Œç”¨ <code>percentile_cont</code>ï¼›</li>
<li>è‹¥æ•°æ®æ˜¯<strong>ç¦»æ•£å‹</strong>ï¼ˆå¦‚è¯„åˆ†ã€æ•°é‡ï¼‰ï¼Œæˆ–è¦æ±‚ç»“æœå¿…é¡»æ˜¯åŸå§‹æ•°æ®ä¸­çš„å€¼ï¼Œç”¨ <code>percentile_disc</code>ã€‚</li>
</ul>
</li>
</ul>
<p>Trino</p>
<ul>
<li><code>approx_percentile()</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* PostgreSQLè¯­æ³• */</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">percentile_cont</span>(<span class="number">0.5</span>) <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> sales)</span><br><span class="line">,<span class="built_in">percentile_disc</span>(<span class="number">0.5</span>) <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> sales)</span><br><span class="line"><span class="keyword">from</span> t;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Trinoè¯­æ³• */</span></span><br><span class="line"><span class="comment">-- åŸºç¡€ç”¨æ³•ï¼ˆè¿”å›è¿‘ä¼¼å€¼ï¼‰</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">approx_percentile(sales, <span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">from</span> t;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŒ‰å•†åº—åˆ†ç»„</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">shop</span><br><span class="line">,approx_percentile(sales, <span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">from</span> t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½œä¸ºçª—å£å‡½æ•°</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">shop</span><br><span class="line">,approx_percentile(sales, <span class="number">0.5</span>) <span class="keyword">over</span>(partiiton <span class="keyword">by</span> shop)</span><br><span class="line"><span class="keyword">from</span> t;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¤šä¸ªç™¾åˆ†ä½æ•°</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">approx_percentile(sales, <span class="keyword">array</span>[<span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">0.75</span>])</span><br><span class="line"><span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>

<p>é€šç”¨è§£æ³•ï¼š</p>
<p>æ’åºæ±‚è§£</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> tmp1 <span class="keyword">as</span>(</span><br><span class="line"><span class="keyword">select</span> sales</span><br><span class="line">,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sales) <span class="keyword">as</span> rn</span><br><span class="line">,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>() <span class="keyword">as</span> total_rows</span><br><span class="line"><span class="keyword">from</span> t</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(sales) <span class="keyword">as</span> median</span><br><span class="line"><span class="keyword">from</span> tmp1</span><br><span class="line"><span class="keyword">where</span> rn <span class="keyword">in</span>((total_rows<span class="operator">+</span><span class="number">1</span>) div <span class="number">2</span>, (total_rows<span class="operator">+</span><span class="number">2</span>) <span class="operator">/</span> <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>count(*) over() as total_rows</code>  â€“ çª—å£å‡½æ•°ï¼šå…¨è¡¨æ€»è¡Œæ•°ï¼ˆä¸åˆ†ç»„ï¼‰</li>
<li><code>where rn in((total_rows+1) div 2, (total_rows+2) / 2)</code>æˆ‘æ²¡æ‡‚</li>
</ul>
<p>â€‹	è¿™æ®µæ¡ä»¶çš„æ ¸å¿ƒæ˜¯ <strong>ç”¨ä¸€ä¸ªå…¬å¼åŒæ—¶é€‚é… â€œå¥‡æ•°æ€»è¡Œæ•°â€ å’Œ â€œå¶æ•°æ€»è¡Œæ•°â€</strong>ï¼Œä¸ç”¨å†™ IF&#x2F;CASE åˆ¤æ–­ï¼Œé æ•´æ•°é™¤æ³•çš„ç‰¹æ€§è‡ªåŠ¨ç­›é€‰å‡ºéœ€è¦çš„ä¸­é—´è¡Œã€‚å’±ä»¬ç”¨ã€Œå…·ä½“ä¾‹å­ã€æ‹†è§£ï¼Œç¬é—´å°±èƒ½æ‡‚ï¼</p>
<p><strong>å…ˆæ˜ç¡®ä¸¤ä¸ªå‰æ</strong></p>
<ul>
<li><code>rn</code>ï¼šæŒ‰é”€å”®é¢æ’åºåçš„å”¯ä¸€è¡Œå·ï¼ˆ1ã€2ã€3ã€â€¦ã€total_rowsï¼‰ï¼›</li>
<li><code>total_rows</code>ï¼šæ•°æ®é›†çš„æ€»è¡Œæ•°ï¼ˆæ¯”å¦‚ 5 è¡Œã€6 è¡Œï¼Œåˆ†åˆ«å¯¹åº”å¥‡æ•°ã€å¶æ•°ï¼‰ï¼›</li>
<li>å…³é”®ï¼šSQL é‡Œçš„æ•´æ•°é™¤æ³•ï¼ˆæ¯”å¦‚ (5+1)&#x2F;2ï¼‰ä¼š <strong>è‡ªåŠ¨å‘ä¸‹å–æ•´</strong>ï¼ˆä¸ç”¨ç®¡å°æ•°éƒ¨åˆ†ï¼‰ã€‚</li>
</ul>
<p><strong>ä¾‹å­ 1ï¼šæ€»è¡Œæ•°æ˜¯å¥‡æ•°ï¼ˆtotal_rows&#x3D;5ï¼‰</strong></p>
<p>æ¯”å¦‚æ•°æ®æ’åºåè¡Œå· <code>rn=1ã€2ã€3ã€4ã€5</code>ï¼Œä¸­ä½æ•°æ˜¯ç¬¬ 3 è¡Œçš„å€¼ã€‚ä»£å…¥å…¬å¼è®¡ç®—ä¸¤ä¸ªä½ç½®ï¼š</p>
<ol>
<li>ç¬¬ä¸€ä¸ªä½ç½®ï¼š<code>(5+1)/2 = 3</code>ï¼ˆæ•´æ•°é™¤æ³•ï¼Œç»“æœ &#x3D; 3ï¼‰ï¼›</li>
<li>ç¬¬äºŒä¸ªä½ç½®ï¼š<code>(5+2)/2 = 3.5</code>ï¼ˆæ•´æ•°é™¤æ³•ï¼Œå‘ä¸‹å–æ•´ &#x3D; 3ï¼‰ï¼›</li>
</ol>
<p>æ‰€ä»¥ <code>rn IN (3, 3)</code> â†’ å®é™…ç­›é€‰ <code>rn=3</code> çš„è¡Œï¼ˆåª 1 è¡Œï¼‰ï¼Œç”¨ AVG è®¡ç®—å°±æ˜¯å®ƒæœ¬èº«ï¼ˆä¸­ä½æ•° &#x3D; ç¬¬ 3 è¡Œçš„å€¼ï¼‰ã€‚</p>
<p><strong>ä¾‹å­ 2ï¼šæ€»è¡Œæ•°æ˜¯å¶æ•°ï¼ˆtotal_rows&#x3D;6ï¼‰</strong></p>
<p>æ¯”å¦‚æ•°æ®æ’åºåè¡Œå· <code>rn=1ã€2ã€3ã€4ã€5ã€6</code>ï¼Œä¸­ä½æ•°æ˜¯ç¬¬ 3 è¡Œå’Œç¬¬ 4 è¡Œçš„å¹³å‡å€¼ã€‚ä»£å…¥å…¬å¼è®¡ç®—ä¸¤ä¸ªä½ç½®ï¼š</p>
<ol>
<li>ç¬¬ä¸€ä¸ªä½ç½®ï¼š<code>(6+1)/2 = 3.5</code>ï¼ˆæ•´æ•°é™¤æ³•ï¼Œå‘ä¸‹å–æ•´ &#x3D; 3ï¼‰ï¼›</li>
<li>ç¬¬äºŒä¸ªä½ç½®ï¼š<code>(6+2)/2 = 4</code>ï¼ˆæ•´æ•°é™¤æ³•ï¼Œç»“æœ &#x3D; 4ï¼‰ï¼›</li>
</ol>
<p>æ‰€ä»¥ <code>rn IN (3, 4)</code> â†’ ç­›é€‰å‡ºç¬¬ 3 è¡Œå’Œç¬¬ 4 è¡Œï¼Œç”¨ AVG è®¡ç®—å°±æ˜¯è¿™ä¸¤ä¸ªå€¼çš„å¹³å‡ï¼ˆä¸­ä½æ•° &#x3D;ï¼ˆç¬¬ 3 è¡Œ + ç¬¬ 4 è¡Œï¼‰&#x2F;2ï¼‰ã€‚</p>
<p><strong>ä¸€å¥è¯æ€»ç»“å…¬å¼çš„å·§å¦™ä¹‹å¤„</strong></p>
<ul>
<li>å¥‡æ•°è¡Œï¼šä¸¤ä¸ªå…¬å¼ç®—å‡ºæ¥çš„ä½ç½® <strong>ç›¸åŒ</strong> â†’ åªå– 1 è¡Œï¼›</li>
<li>å¶æ•°è¡Œï¼šä¸¤ä¸ªå…¬å¼ç®—å‡ºæ¥çš„ä½ç½® <strong>ç›¸é‚»</strong> â†’ å– 2 è¡Œï¼›</li>
</ul>
<h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p><code>UNION ALL</code>ï¼šåˆå¹¶ç»“æœ</p>
<p><strong>è‡ªè¿æ¥ (Self Join)</strong>: ç”¨äºæ¯”è¾ƒè¡¨å†…ç›¸åŒè®°å½•ï¼ˆä¾‹å¦‚ï¼ŒæŸ¥æ‰¾è–ªèµ„é«˜äºå…¶ç»ç†çš„å‘˜å·¥ï¼ŒæŸ¥æ‰¾é‡å¤è®°å½•ï¼‰ã€‚</p>
<p><strong>å­—ç¬¦ä¸²å¤„ç†</strong>: æ–‡æœ¬æå–ã€æ‹¼æ¥ã€æ¨¡å¼åŒ¹é…ç­‰ã€‚</p>
<p><strong>æ—¥æœŸ&#x2F;æ—¶é—´å¤„ç†</strong>: å¤æ‚çš„æ—¥æœŸè®¡ç®—ã€è·¨æ—¶åŒºå¤„ç†ã€æ—¶é—´çª—å£èšåˆç­‰ã€‚</p>
<p><strong>åœ°ç†ç©ºé—´æŸ¥è¯¢</strong>: ä½¿ç”¨ PostGIS ç­‰æ‰©å±•è¿›è¡Œç©ºé—´æ•°æ®åˆ†æï¼ˆåœ¨ PostgreSQL ä¸­å¸¸è§ï¼‰ã€‚</p>
<p><strong>æ•°æ®å€¾æ–œå¤„ç†</strong>: åœ¨åˆ†å¸ƒå¼ SQL å¼•æ“ï¼ˆå¦‚ Trinoï¼‰ä¸­ï¼Œå¦‚ä½•è¯†åˆ«å’Œå¤„ç†å› æ•°æ®åˆ†å¸ƒä¸å‡å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<hr>
<h1 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h1><h2 id="æ—¥æœŸ-æ—¶é—´æˆ³â†’æ•°å€¼"><a href="#æ—¥æœŸ-æ—¶é—´æˆ³â†’æ•°å€¼" class="headerlink" title="æ—¥æœŸ&#x2F;æ—¶é—´æˆ³â†’æ•°å€¼"></a>æ—¥æœŸ&#x2F;æ—¶é—´æˆ³â†’æ•°å€¼</h2><p>å„æ•°æ®åº“çš„æ›¿ä»£å†™æ³•</p>
<table>
<thead>
<tr>
<th align="left">æ•°æ®åº“</th>
<th align="left">å†™æ³•</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>PostgreSQL</strong></td>
<td align="left"><code>extract(epoch from date)</code></td>
</tr>
<tr>
<td align="left"><strong>Trino</strong></td>
<td align="left"><code>to_unixtime(date)</code></td>
</tr>
<tr>
<td align="left"><strong>MySQL</strong></td>
<td align="left"><code>unix_timestamp(date)</code></td>
</tr>
<tr>
<td align="left"><strong>Hive</strong></td>
<td align="left"><code>unix_timestamp(date)</code></td>
</tr>
</tbody></table>
<p>ä¸ºä»€ä¹ˆUnixæ—¶é—´æˆ³æ›´é€‚åˆå›å½’åˆ†æ</p>
<ul>
<li><strong>Unixæ—¶é—´æˆ³</strong>: æ¯å¤©å‡åŒ€å¢åŠ  <code>86400</code> ç§’ï¼Œé€‚åˆçº¿æ€§å›å½’</li>
<li><strong>YYYYMMDDæ ¼å¼</strong>: æ•°å­—è·³è·ƒå¾ˆå¤§ï¼ˆ<code>20250901</code> â†’ <code>20250902</code>ï¼‰ï¼Œä¸”é—´éš”ä¸å‡åŒ€</li>
</ul>
<h2 id="å‡½æ•°è¯­æ³•"><a href="#å‡½æ•°è¯­æ³•" class="headerlink" title="å‡½æ•°è¯­æ³•"></a>å‡½æ•°è¯­æ³•</h2><p>å…¨éƒ¨éƒ½æ”¯æŒé€šç”¨æ ‡å‡†è½¬æ¢ï¼š<code>cast(expr as type)</code></p>
<table>
<thead>
<tr>
<th align="left">æ•°æ®åº“</th>
<th align="left">ä¸“ç”¨è½¬æ¢å‡½æ•°</th>
<th>å­—ç¬¦ä¸²â†’æ—¥æœŸ</th>
<th>æ—¥æœŸâ†’å­—ç¬¦ä¸²</th>
<th>å­—ç¬¦ä¸²â†’æ•´æ•°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>PostgreSQL</strong></td>
<td align="left"><code>::</code>æ“ä½œç¬¦</td>
<td><code>cast(expr as date)</code></td>
<td><code>cast(expr as text)</code></td>
<td><code>cast(expr as integer)</code></td>
</tr>
<tr>
<td align="left"><strong>Trino</strong></td>
<td align="left"><code>try_cast()</code></td>
<td><code>cast(expr as date)</code></td>
<td><code>cast(expr as varchar)</code></td>
<td><code>cast(expr as integer)</code></td>
</tr>
<tr>
<td align="left"><strong>MySQL</strong></td>
<td align="left"><code>convert(),cast()</code></td>
<td><code>cast(expr as date)</code></td>
<td><code>cast(expr as char)</code></td>
<td><code>cast(expr as signed)</code></td>
</tr>
<tr>
<td align="left"><strong>Hive</strong></td>
<td align="left">æ— <code>try_cast</code></td>
<td><code>cast(expr as date)</code></td>
<td><code>cast(expr as string)</code></td>
<td><code>cast(expr as int)</code></td>
</tr>
</tbody></table>
<p>ä¸åŒæ•°æ®åº“ä¸­çš„æ•°æ®ç±»å‹è½¬æ¢ï¼Œæ•°æ®åº“ç±»å‹æŒ‰ç…§ä¼ä¸šçº§åˆ†ç±»</p>
<table>
<thead>
<tr>
<th align="left">åˆ†ç±»</th>
<th align="left">æ•°æ®åº“</th>
<th align="left">æ ‡å‡†CAST</th>
<th align="left">æ¨è&#x2F;ä¸“ç”¨è½¬æ¢è¯­æ³•</th>
<th align="left">æ ¸å¿ƒç‰¹ç‚¹ä¸æ³¨æ„äº‹é¡¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>ğŸ”’ ä¼ ç»ŸOLTP</strong></td>
<td align="left"><strong>PostgreSQL</strong></td>
<td align="left">âœ…</td>
<td align="left"><code>expr::type</code> <code>to_char(expr)</code> <code>extract(epoch from expr)</code></td>
<td align="left"><strong>ç±»å‹ç³»ç»Ÿæœ€ä¸¥æ ¼</strong>ï¼Œè½¬æ¢å¤±è´¥ç›´æ¥æŠ¥é”™ã€‚åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæ”¯æŒè‡ªå®šä¹‰ç±»å‹å’Œè¿ç®—ç¬¦ã€‚</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>MySQL</strong></td>
<td align="left">âœ…</td>
<td align="left"><code>CONVERT(expr, type)</code> <code>DATE_FORMAT(...)</code> <code>CAST(expr as signed)</code></td>
<td align="left"><strong>éšå¼è½¬æ¢å®½æ¾</strong>ï¼Œå¯èƒ½å¯¼è‡´æ„å¤–ç»“æœã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²è½¬æ•°å­—ä¼šæˆªå–å¼€å¤´éƒ¨åˆ†ã€‚</td>
</tr>
<tr>
<td align="left"><strong>ğŸš€ å¤§æ•°æ®OLAP</strong></td>
<td align="left"><strong>Trino&#x2F;Presto</strong></td>
<td align="left">âœ…</td>
<td align="left"><strong><code>try_cast(expr as type)</code></strong> <code>to_unixtime(expr)</code> <code>format_datetime(expr)</code></td>
<td align="left"><strong>å¼ºè°ƒç¨³å®šæ€§</strong>ã€‚<code>try_cast</code>è½¬æ¢å¤±è´¥è¿”å›<code>NULL</code>ï¼Œæ˜¯ETLä»»åŠ¡é¦–é€‰ã€‚ç±»å‹åå¤šç”¨<code>VARCHAR</code>ã€‚</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>Spark SQL</strong></td>
<td align="left">âœ…</td>
<td align="left"><code>try_cast(expr as type)</code> (æ–°ç‰ˆæœ¬) <code>date_format(...)</code> <code>unix_timestamp(...)</code></td>
<td align="left">ä¸Trinoç†å¿µç±»ä¼¼ï¼Œä½†å‡½æ•°åæ›´æ¥è¿‘Hiveã€‚å¤„ç†è„æ•°æ®æ—¶æ¨èä½¿ç”¨<code>try_cast</code>ã€‚</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><strong>Hive</strong></td>
<td align="left">âœ…</td>
<td align="left"><code>unix_timestamp(...)</code> <code>from_unixtime(...)</code> <code>date_format(...)</code></td>
<td align="left"><strong>â€œè¯»æ—¶æ¨¡å¼â€</strong>ï¼Œè½¬æ¢ç›¸å¯¹å®½æ¾ã€‚ç‰ˆæœ¬é—´è¡Œä¸ºå¯èƒ½æœ‰å˜ï¼ˆå¦‚Hive 3æ—¶é—´æˆ³æ—¶åŒºå¤„ç†ï¼‰ã€‚</td>
</tr>
<tr>
<td align="left"><strong>ğŸŒ äº‘åŸç”ŸHTAP</strong></td>
<td align="left"><strong>TiDB</strong></td>
<td align="left">âœ…</td>
<td align="left"><code>CONVERT(expr, type)</code> <code>DATE_FORMAT(...)</code></td>
<td align="left"><strong>é«˜åº¦å…¼å®¹MySQLè¯­æ³•</strong>ï¼Œä½†ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒæŸäº›å‡½æ•°ï¼ˆå¦‚<code>CONVERT</code>ï¼‰çš„è¡Œä¸ºæ—¨åœ¨ç¡®ä¿é›†ç¾¤ä¸€è‡´æ€§ã€‚</td>
</tr>
<tr>
<td align="left"><strong>ğŸ“ˆ ä¸“ç”¨OLAP</strong></td>
<td align="left"><strong>ClickHouse</strong></td>
<td align="left">âœ…</td>
<td align="left"><strong><code>accurateCast(expr, type)</code></strong> <code>toUnixTimestamp(...)</code> <code>toString(...)</code></td>
<td align="left"><strong>ç±»å‹è½¬æ¢å‡½æ•°å®¶æ—åºå¤§</strong>ã€‚<code>accurateCast</code>æ›´å®‰å…¨ï¼ˆèŒƒå›´æ£€æŸ¥ï¼‰ï¼Œ<code>cast</code>ä¼šå°è¯•å°½åŠ›è½¬æ¢ã€‚</td>
</tr>
</tbody></table>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://kkkika.github.io/">Kika</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://kkkika.github.io/2025/10/20/%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/">https://kkkika.github.io/2025/10/20/å¿«é€Ÿç²¾é€šSQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://kkkika.github.io" target="_blank">Kkkika</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL/">SQL</a><a class="post-meta__tags" href="/tags/PostgreSQL/">PostgreSQL</a></div><div class="post-share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_wechat"></a><a class="a2a_button_copy_link"></a><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/24/%E5%A4%A7%E6%96%87%E6%A1%A3/" title="å¤§æ–‡æ¡£"><img class="cover" src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">å¤§æ–‡æ¡£</div></div><div class="info-2"><div class="info-item-1">  ...</div></div></div></a><a class="pagination-related" href="/2025/10/21/SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/" title="SQLçª—å£å‡½æ•°"><img class="cover" src="/./../Cover/SQL.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">SQLçª—å£å‡½æ•°</div></div><div class="info-2"><div class="info-item-1">çª—å£å‡½æ•°çš„å‡½æ•°ï¼Œç¤ºä¾‹æ¼”ç¤ºï¼Œæ·±å…¥ç†è§£å’Œä½¿ç”¨</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/23/SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E9%80%9F%E6%9F%A5%E8%A1%A8/" title="SQLçª—å£å‡½æ•°é€ŸæŸ¥è¡¨"><img class="cover" src="/./../Cover/SQL.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-09-24</div><div class="info-item-2">SQLçª—å£å‡½æ•°é€ŸæŸ¥è¡¨</div></div><div class="info-2"><div class="info-item-1">24ä¸ªSQL æ ‡å‡†ä¸­å®šä¹‰çš„å…¨éƒ¨çª—å£å‡½æ•°ï¼ˆWindow Functionï¼‰ï¼Œæ¯ä¸ªå‡½æ•°ç”¨ä¸€å¥è¯æ¦‚æ‹¬å…¶æ ¸å¿ƒç”¨é€”ï¼Œæ–¹ä¾¿æ—¥å¸¸æŸ¥é˜…æ—¶èƒ½å¿«é€Ÿå¯¹åº”åˆ°éœ€æ±‚</div></div></div></a><a class="pagination-related" href="/2025/09/23/SQL%E5%AD%90%E6%9F%A5%E8%AF%A2/" title="SQLå­æŸ¥è¯¢"><img class="cover" src="/./../Cover/SQL.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-10-20</div><div class="info-item-2">SQLå­æŸ¥è¯¢</div></div><div class="info-2"><div class="info-item-1">æŠŠâ€œå¿…é¡»ç”¨å­æŸ¥è¯¢â€å’Œâ€œå¯ä»¥æ”¹ JOIN / WITH æé€Ÿâ€è¿™ä¸¤ç§åœºæ™¯ä¸€æ¬¡æ€§æ‹†å¼€è®²é€ã€‚æ¯æ¡éƒ½ç»™å‡º Trinoï¼ˆPrestoï¼‰è¯­æ³•ç¤ºä¾‹</div></div></div></a><a class="pagination-related" href="/2025/10/21/SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/" title="SQLçª—å£å‡½æ•°"><img class="cover" src="/./../Cover/SQL.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-10-23</div><div class="info-item-2">SQLçª—å£å‡½æ•°</div></div><div class="info-2"><div class="info-item-1">çª—å£å‡½æ•°çš„å‡½æ•°ï¼Œç¤ºä¾‹æ¼”ç¤ºï¼Œæ·±å…¥ç†è§£å’Œä½¿ç”¨</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Kika</div><div class="author-info-description">Why so serious?</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Kkkika"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Kkkika" target="_blank" title="Github"><i class="fab fa-github" style="color: #FDB68C;"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_73972962" target="_blank" title="CSDN"><i class="fa fa-search" style="color: #FDB68C;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æŒç»­æ›´æ–°ä¸­...<br>æ¬¢è¿å…³æ³¨æˆ‘çš„ GitHubï¼Œè·å–æ›´å¤šå¼€æºé¡¹ç›®å’Œæ•™ç¨‹åˆ†äº«ï¼</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">é‡ç‚¹çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">SQLæ‰§è¡Œé¡ºåºï¼š</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">SQLåŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">åŸºç¡€è¯­æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.1.1.</span> <span class="toc-text">æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%E3%80%81%E5%88%A0%E8%A1%A8%E3%80%81%E5%88%86%E5%8C%BA"><span class="toc-number">2.1.2.</span> <span class="toc-text">å»ºè¡¨ã€åˆ è¡¨ã€åˆ†åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%92%8C%E9%9D%9E%E5%88%86%E5%8C%BA%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">åˆ†åŒºå’Œéåˆ†åŒºçš„åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.1.3.</span> <span class="toc-text">è¡¨è¿æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.4.</span> <span class="toc-text">å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E3%80%81%E5%88%86%E7%BB%84%E3%80%81%E6%8E%92%E5%BA%8F"><span class="toc-number">2.1.5.</span> <span class="toc-text">åµŒå¥—ã€åˆ†ç»„ã€æ’åº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="toc-number">2.1.6.</span> <span class="toc-text">SQLä¼˜åŒ–çš„æŠ€å·§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E9%99%90%E5%88%B6"><span class="toc-number">2.1.6.1.</span> <span class="toc-text">åˆ†åŒºé™åˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E8%BF%87%E6%BB%A4%E5%86%8D%E5%85%B3%E8%81%94"><span class="toc-number">2.1.6.2.</span> <span class="toc-text">å…ˆè¿‡æ»¤å†å…³è”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E8%BF%87%E6%BB%A4%E5%86%8D%E4%BD%BF%E7%94%A8%E5%A4%8D%E6%9D%82%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.6.3.</span> <span class="toc-text">å…ˆè¿‡æ»¤å†ä½¿ç”¨å¤æ‚å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E8%BF%87%E6%BB%A4null"><span class="toc-number">2.1.6.4.</span> <span class="toc-text">æå‰è¿‡æ»¤null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8group-by%E5%8E%BB%E9%87%8D"><span class="toc-number">2.1.6.5.</span> <span class="toc-text">ç”¨group byå»é‡</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%B77%E5%A4%A7%E7%B1%BB%E5%9E%8BSQL%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">åˆ·7å¤§ç±»å‹SQLé¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E7%B1%BB%E9%97%AE%E9%A2%98%EF%BC%88%E6%99%AE%E9%80%9A%E6%8E%92%E5%BA%8F%EF%BC%8C%E7%BB%84%E5%86%85%E6%8E%92%E5%BA%8F%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">æ’åºç±»é—®é¢˜ï¼ˆæ™®é€šæ’åºï¼Œç»„å†…æ’åºï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TOPN-%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.</span> <span class="toc-text">TOPN é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%95%99%E5%AD%98%E3%80%81%E5%A4%8D%E8%B4%AD%E7%8E%87%E3%80%81%E5%AE%8C%E6%92%AD%E7%8E%87%E7%AD%89%E8%AE%A1%E7%AE%97%E5%A4%8D%E5%90%88%E6%8C%87%E6%A0%87%E9%97%AE%E9%A2%98"><span class="toc-number">3.3.</span> <span class="toc-text">ç”¨æˆ·ç•™å­˜ã€å¤è´­ç‡ã€å®Œæ’­ç‡ç­‰è®¡ç®—å¤åˆæŒ‡æ ‡é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%94%A8%E6%88%B7%E6%95%B0%E3%80%81%E7%94%A8%E6%88%B7%E9%97%B4%E9%9A%94%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E5%A4%A9%E6%95%B0%E3%80%81%E6%9C%80%E9%95%BF%E8%BF%9E%E7%BB%AD%E7%99%BB%E9%99%86%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.</span> <span class="toc-text">æ–°ç”¨æˆ·æ•°ã€ç”¨æˆ·é—´éš”è¿ç»­ç™»å½•å¤©æ•°ã€æœ€é•¿è¿ç»­ç™»é™†é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%96%E9%9F%B3%E7%94%B5%E5%95%86%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%AC%94%E8%AF%95SQL%E9%A2%98"><span class="toc-number">3.4.1.</span> <span class="toc-text">æŠ–éŸ³ç”µå•†æ•°æ®åˆ†æç¬”è¯•SQLé¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%8F%E7%A7%BB%E7%B1%BB%E6%B1%82%E5%92%8C%E6%B1%82%E5%B9%B3%E5%9D%87%E9%97%AE%E9%A2%98%EF%BC%88lag-lead%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">åç§»ç±»æ±‚å’Œæ±‚å¹³å‡é—®é¢˜ï¼ˆlag, leadå‡½æ•°ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E5%88%97%E4%BA%92%E8%BD%AC%E9%97%AE%E9%A2%98"><span class="toc-number">3.6.</span> <span class="toc-text">è¡Œåˆ—äº’è½¬é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E4%BD%8D%E6%95%B0%E9%97%AE%E9%A2%98"><span class="toc-number">3.7.</span> <span class="toc-text">ä¸­ä½æ•°é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">3.8.</span> <span class="toc-text">å…¶ä»–é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">4.</span> <span class="toc-text">ç±»å‹è½¬æ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F-%E6%97%B6%E9%97%B4%E6%88%B3%E2%86%92%E6%95%B0%E5%80%BC"><span class="toc-number">4.1.</span> <span class="toc-text">æ—¥æœŸ&#x2F;æ—¶é—´æˆ³â†’æ•°å€¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%AF%AD%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">å‡½æ•°è¯­æ³•</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/27/%E8%B7%9F%E7%9D%80%E5%A4%A7%E4%BD%AC%E5%AD%A6%E6%95%B0%E5%88%862/" title="è·Ÿç€å¤§ä½¬å­¦æ•°åˆ†2"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è·Ÿç€å¤§ä½¬å­¦æ•°åˆ†2"/></a><div class="content"><a class="title" href="/2025/10/27/%E8%B7%9F%E7%9D%80%E5%A4%A7%E4%BD%AC%E5%AD%A6%E6%95%B0%E5%88%862/" title="è·Ÿç€å¤§ä½¬å­¦æ•°åˆ†2">è·Ÿç€å¤§ä½¬å­¦æ•°åˆ†2</a><time datetime="2025-10-27T00:55:30.000Z" title="å‘è¡¨äº 2025-10-27 08:55:30">2025-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/24/%E8%B7%9F%E7%9D%80%E5%A4%A7%E4%BD%AC%E7%BB%83%E6%95%B0%E5%88%86/" title="è·Ÿç€å¤§ä½¬ç»ƒæ•°åˆ†"><img src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è·Ÿç€å¤§ä½¬ç»ƒæ•°åˆ†"/></a><div class="content"><a class="title" href="/2025/10/24/%E8%B7%9F%E7%9D%80%E5%A4%A7%E4%BD%AC%E7%BB%83%E6%95%B0%E5%88%86/" title="è·Ÿç€å¤§ä½¬ç»ƒæ•°åˆ†">è·Ÿç€å¤§ä½¬ç»ƒæ•°åˆ†</a><time datetime="2025-10-24T07:20:01.000Z" title="å‘è¡¨äº 2025-10-24 15:20:01">2025-10-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/22/AB%E5%AE%9E%E9%AA%8C/" title="ABå®éªŒ"><img src="/./../Cover/ABtest.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ABå®éªŒ"/></a><div class="content"><a class="title" href="/2025/10/22/AB%E5%AE%9E%E9%AA%8C/" title="ABå®éªŒ">ABå®éªŒ</a><time datetime="2025-10-22T00:34:53.000Z" title="å‘è¡¨äº 2025-10-22 08:34:53">2025-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/21/SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/" title="SQLçª—å£å‡½æ•°"><img src="/./../Cover/SQL.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQLçª—å£å‡½æ•°"/></a><div class="content"><a class="title" href="/2025/10/21/SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/" title="SQLçª—å£å‡½æ•°">SQLçª—å£å‡½æ•°</a><time datetime="2025-10-21T06:11:09.000Z" title="å‘è¡¨äº 2025-10-21 14:11:09">2025-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/20/%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/" title="å¿«é€Ÿç²¾é€šSQL"><img src="/./../Cover/SQL.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å¿«é€Ÿç²¾é€šSQL"/></a><div class="content"><a class="title" href="/2025/10/20/%E5%BF%AB%E9%80%9F%E7%B2%BE%E9%80%9ASQL/" title="å¿«é€Ÿç²¾é€šSQL">å¿«é€Ÿç²¾é€šSQL</a><time datetime="2025-10-20T09:17:43.000Z" title="å‘è¡¨äº 2025-10-20 17:17:43">2025-10-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Kika</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-beat"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æ—¥å¤œåˆ‡æ¢"><i class="fas fa-adjust fa-flip"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up fa-bounce"></i></button><button id="go-down" type="button" title="å›åˆ°åº•éƒ¨"><i class="fas fa-arrow-down fa-bounce"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="253,114,16" opacity="0.9" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>